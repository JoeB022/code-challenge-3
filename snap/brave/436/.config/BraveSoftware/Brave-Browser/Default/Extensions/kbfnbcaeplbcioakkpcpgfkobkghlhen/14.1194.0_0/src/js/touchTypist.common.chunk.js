(self.webpackChunk=self.webpackChunk||[]).push([[1824],{46489:(e,t,r)=>{r.r(t),r.d(t,{TouchTypistFeatureImpl:()=>re});var i=r(82823),s=r(49144),a=r(78488),n=r(55446),o=r(65647),c=r(58303),l=r(67325),p=r(90049),h=r(64965),g=r(34859),u=r(60841),d=r(20715),m=r(74857),C=r(14765),_=r(49231),f=r(6505);const v=_.createElement("svg",{width:"34",height:"25",viewBox:"0 0 34 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_.createElement("g",{filter:"url(#filter0_dd_4597_4298)"},_.createElement("mask",{id:"path-2-outside-1_4597_4298",maskUnits:"userSpaceOnUse",x:"6.5",y:"6",width:"21",height:"14",fill:"black"},_.createElement("rect",{fill:"white",x:"6.5",y:"6",width:"21",height:"14"}),_.createElement("path",{d:"M7.5 11C7.5 9.59987 7.5 8.8998 7.77248 8.36502C8.01217 7.89462 8.39462 7.51217 8.86502 7.27248C9.3998 7 10.0999 7 11.5 7H22.5C23.9001 7 24.6002 7 25.135 7.27248C25.6054 7.51217 25.9878 7.89462 26.2275 8.36502C26.5 8.8998 26.5 9.59987 26.5 11V14C26.5 15.4001 26.5 16.1002 26.2275 16.635C25.9878 17.1054 25.6054 17.4878 25.135 17.7275C24.6002 18 23.9001 18 22.5 18H11.5C10.0999 18 9.3998 18 8.86502 17.7275C8.39462 17.4878 8.01217 17.1054 7.77248 16.635C7.5 16.1002 7.5 15.4001 7.5 14V11Z"})),_.createElement("path",{d:"M7.5 11C7.5 9.59987 7.5 8.8998 7.77248 8.36502C8.01217 7.89462 8.39462 7.51217 8.86502 7.27248C9.3998 7 10.0999 7 11.5 7H22.5C23.9001 7 24.6002 7 25.135 7.27248C25.6054 7.51217 25.9878 7.89462 26.2275 8.36502C26.5 8.8998 26.5 9.59987 26.5 11V14C26.5 15.4001 26.5 16.1002 26.2275 16.635C25.9878 17.1054 25.6054 17.4878 25.135 17.7275C24.6002 18 23.9001 18 22.5 18H11.5C10.0999 18 9.3998 18 8.86502 17.7275C8.39462 17.4878 8.01217 17.1054 7.77248 16.635C7.5 16.1002 7.5 15.4001 7.5 14V11Z",fill:"white",shapeRendering:"crispEdges"}),_.createElement("path",{d:"M7 9.5C7 7.84315 8.34315 6.5 10 6.5H24C25.6569 6.5 27 7.84315 27 9.5H26C26 8.39543 25.1046 7.5 24 7.5H10C8.89543 7.5 8 8.39543 8 9.5H7ZM27 16.5C27 18.1569 25.6569 19.5 24 19.5H10C8.34315 19.5 7 18.1569 7 16.5L8 15.5C8 16.0523 8.89543 16.5 10 16.5H24C25.1046 16.5 26 16.0523 26 15.5L27 16.5ZM10 19.5C8.34315 19.5 7 18.1569 7 16.5V9.5C7 7.84315 8.34315 6.5 10 6.5V7.5C8.89543 7.5 8 8.39543 8 9.5V15.5C8 16.0523 8.89543 16.5 10 16.5V19.5ZM24 6.5C25.6569 6.5 27 7.84315 27 9.5V16.5C27 18.1569 25.6569 19.5 24 19.5V16.5C25.1046 16.5 26 16.0523 26 15.5V9.5C26 8.39543 25.1046 7.5 24 7.5V6.5Z",fill:"#707070",mask:"url(#path-2-outside-1_4597_4298)"}),_.createElement("path",{d:"M9.42023 9.80469V8.95455H14.4859V9.80469H12.4437V15.5H11.4593V9.80469H9.42023ZM16.2893 15.6087C15.9782 15.6087 15.697 15.5511 15.4455 15.4361C15.1941 15.3189 14.9949 15.1495 14.8479 14.9279C14.703 14.7063 14.6305 14.4347 14.6305 14.1129C14.6305 13.8359 14.6838 13.608 14.7903 13.429C14.8969 13.25 15.0407 13.1083 15.2218 13.0039C15.4029 12.8995 15.6053 12.8207 15.8291 12.7674C16.0528 12.7141 16.2808 12.6737 16.513 12.646C16.807 12.6119 17.0457 12.5842 17.2289 12.5629C17.4122 12.5394 17.5453 12.5021 17.6284 12.451C17.7115 12.3999 17.7531 12.3168 17.7531 12.2017V12.1793C17.7531 11.9002 17.6742 11.6839 17.5166 11.5305C17.361 11.3771 17.1288 11.3004 16.8198 11.3004C16.4981 11.3004 16.2445 11.3718 16.0592 11.5146C15.8759 11.6552 15.7492 11.8118 15.6788 11.9844L14.7808 11.7798C14.8873 11.4815 15.0428 11.2408 15.2474 11.0575C15.4541 10.8722 15.6916 10.7379 15.9601 10.6548C16.2286 10.5696 16.5109 10.527 16.807 10.527C17.0031 10.527 17.2108 10.5504 17.4303 10.5973C17.6519 10.642 17.8585 10.7251 18.0503 10.8466C18.2442 10.968 18.4029 11.1417 18.5265 11.3675C18.6501 11.5913 18.7119 11.8821 18.7119 12.2401V15.5H17.7786V14.8288H17.7403C17.6785 14.9524 17.5858 15.0739 17.4622 15.1932C17.3386 15.3125 17.1799 15.4116 16.986 15.4904C16.7921 15.5692 16.5599 15.6087 16.2893 15.6087ZM16.497 14.8416C16.7612 14.8416 16.9871 14.7894 17.1746 14.685C17.3642 14.5806 17.508 14.4442 17.606 14.2759C17.7062 14.1055 17.7563 13.9233 17.7563 13.7294V13.0966C17.7222 13.1307 17.6561 13.1626 17.5581 13.1925C17.4622 13.2202 17.3525 13.2447 17.2289 13.266C17.1053 13.2852 16.985 13.3033 16.8678 13.3203C16.7506 13.3352 16.6526 13.348 16.5737 13.3587C16.3884 13.3821 16.219 13.4215 16.0656 13.4769C15.9143 13.5323 15.7928 13.6122 15.7012 13.7166C15.6117 13.8189 15.567 13.9553 15.567 14.1257C15.567 14.3622 15.6543 14.5412 15.8291 14.6626C16.0038 14.782 16.2264 14.8416 16.497 14.8416ZM20.0614 15.5V8.95455H21.017V11.3867H21.0745C21.1299 11.2844 21.2098 11.1662 21.3142 11.032C21.4186 10.8977 21.5635 10.7805 21.7489 10.6804C21.9343 10.5781 22.1793 10.527 22.484 10.527C22.8803 10.527 23.234 10.6271 23.5451 10.8274C23.8561 11.0277 24.1001 11.3164 24.2769 11.6935C24.4559 12.0707 24.5454 12.5245 24.5454 13.055C24.5454 13.5856 24.457 14.0405 24.2801 14.4197C24.1033 14.7969 23.8604 15.0877 23.5514 15.2923C23.2425 15.4947 22.8899 15.5959 22.4936 15.5959C22.1953 15.5959 21.9513 15.5458 21.7617 15.4457C21.5742 15.3455 21.4272 15.2283 21.3206 15.0941C21.2141 14.9599 21.1321 14.8406 21.0745 14.7362H20.9946V15.5H20.0614ZM20.9978 13.0455C20.9978 13.3906 21.0479 13.6932 21.148 13.9531C21.2482 14.2131 21.3931 14.4165 21.5827 14.5636C21.7723 14.7085 22.0046 14.7809 22.2794 14.7809C22.5649 14.7809 22.8036 14.7053 22.9953 14.554C23.1871 14.4006 23.332 14.1928 23.43 13.9308C23.5301 13.6687 23.5802 13.3736 23.5802 13.0455C23.5802 12.7216 23.5312 12.4308 23.4332 12.1729C23.3373 11.9151 23.1924 11.7116 22.9985 11.5625C22.8068 11.4134 22.5671 11.3388 22.2794 11.3388C22.0024 11.3388 21.7681 11.4102 21.5763 11.5529C21.3867 11.6957 21.2429 11.8949 21.1448 12.1506C21.0468 12.4062 20.9978 12.7045 20.9978 13.0455Z",fill:"#707070"})),_.createElement("defs",null,_.createElement("filter",{id:"filter0_dd_4597_4298",x:"2.5",y:"3",width:"29",height:"22",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},_.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),_.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),_.createElement("feMorphology",{radius:"0.5",operator:"dilate",in:"SourceAlpha",result:"effect1_dropShadow_4597_4298"}),_.createElement("feOffset",{dy:"1"}),_.createElement("feGaussianBlur",{stdDeviation:"2"}),_.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.439216 0 0 0 0 0.439216 0 0 0 0 0.439216 0 0 0 0.5 0"}),_.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4597_4298"}),_.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),_.createElement("feMorphology",{radius:"0.5",operator:"dilate",in:"SourceAlpha",result:"effect2_dropShadow_4597_4298"}),_.createElement("feOffset",null),_.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),_.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.439216 0 0 0 0 0.439216 0 0 0 0 0.439216 0 0 0 1 0"}),_.createElement("feBlend",{mode:"normal",in2:"effect1_dropShadow_4597_4298",result:"effect2_dropShadow_4597_4298"}),_.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_4597_4298",result:"shape"})))),b={position:"absolute",background:"transparent",border:"none",padding:0,width:f.ux.px(33),height:f.ux.px(25),$nest:{"&:hover":{cursor:"pointer"},svg:{width:"100%",height:"100%"}}},y=f.ux.stylesheet({buttonStyles:[b]});function w(e,t,r){const i=p.T(t.scroll.changes,h.R(self,"scroll",{capture:!0})).pipe(g.h(void 0));return e.activeParagraphRange.pipe(u.w((e=>c.Wi(e)?d.of(e):p.T(i.pipe(g.h(c.YP)),i.pipe(m.b(250),g.h(e))).pipe(C.O(e)))),o.U((e=>{if(c.Wi(e))return c.YP;const t=r.getCaretPosition(e);return t?c.G((({top:e,left:t})=>_.createElement("button",{className:y.buttonStyles,style:{top:e,left:t}},v))({top:t.top,left:t.left})):c.YP})))}var T,x,S,P=r(99793),E=r(31584),k=r(25770),R=r(75155),V=r(96030),H=r(47344),O=r(64629);!function(e){e.is=function(e){return 1===e.changes.length&&O.q.isDel(e.changes[0])}}(T||(T={})),function(e){e.is=function(e){return 1===e.changes.length&&O.q.isIns(e.changes[0])}}(x||(x={})),function(e){e.is=function(e){return[x.is,T.is].some((t=>t(e)))}}(S||(S={}));const I=Symbol();var M;!function(e){e.is=e=>e===I}(M||(M={}));var G=r(73863),F=r(90023),A=r(12518),Y=r(88241);var L=r(63843);function U(e,t){const r=Y.Y.create(`TouchTypist.${U.name}`);if(!(t.start===t.end))return r.debug("Selection is not a caret."),c.YP;const i=t;if(!function(e,t){if(O.q.isIns(t))return e===t.pos+t.text.length;if(O.q.isDel(t))return e===t.pos;(0,L.L0)(t)}(i.start,e.changes[0]))return r.debug("Caret is not at the end of the text change."),c.YP;const s=e.newText,a=(0,F.zG)(((e,t)=>{if(t<0||t>e.length)return A.left(new Error("Caret outside of the text boundaries."));let r=t,i=t;for(;r>0&&"\n"!==e.charAt(r-1);)r--;for(;i<e.length&&"\n"!==e.charAt(i);)i++;return A.right({start:r,end:i})})(s,i.start),A.fold((e=>(r.error("Failed to get paragraph range containing position.",e,{text:s,position:i.start}),null)),F.yR));if(!a||a.start===a.end)return r.debug("Paragraph containing caret is empty."),c.YP;return a.end===i.start?c.G(a):(r.debug("Caret is not at the end of its containing paragraph."),c.YP)}class B{constructor(e){this._params=e,this._subs=new i.w,this._activeParagraphRange=k.h.create(c.YP),this.activeParagraphRange=this._activeParagraphRange.view();const t=(r=this._params.textObserver,s=this._params.replacementListener,p.T(s.obs.pipe(g.h(I)),r.contentChanges.async).pipe(C.O(null),V.G(),n.h((([e,t])=>[e,t].every((0,H.ff)(M.is)))),o.U((([e,t])=>t)),n.h(S.is),m.b(1e3)));var r,s;const a=function(e,t){return p.T(e.contentChanges.async,t).pipe(g.h(void 0))}(this._params.textObserver,this._params.selectionOrCaretPosition);this._subs.add(p.T(t.pipe(function(e){const t=e.pipe(P.skipBy(c.Eh(R.SV.eq))).pipe(G.q(1));return e=>e.pipe(u.w((e=>t.pipe(o.U(c.WG),o.U((t=>t?U(e,t):c.YP))))))}(this._params.selectionOrCaretPosition)),a.pipe(g.h(c.YP))).pipe(P.skipBy(c.Eh(R.SV.eq))).subscribe(E.wW(this._activeParagraphRange)))}dispose(){this._subs.unsubscribe()}}var q=r(43534);var Z=r(55362),D=r(70610),W=r(92666),z=r(50664);class ${constructor(e){this._params=e}static getCaretPositionGdocs(e){return(0,F.zG)(c.ij(document.querySelector(e)),c.UI((e=>e.getBoundingClientRect())),c.UI((({left:e,top:t})=>({top:t+16,left:e-15}))),c.WG)}getCaretPositionGeneral(e){const t=(0,F.zG)(e,c.UI((e=>(0,W.FN)((()=>this._params.textObserver.getCurrentTextMap()),this._params.geometryProvider,this._params.geometryLayout,F.yR)(e))),c.UI((e=>e[e.length-1])),c.UI((e=>({left:e.right,top:e.top,width:e.width,height:e.height}))),c.WG);if(!t)return null;const r=(0,z.Z)({...t,kind:"offsetPoint"},this._params.textFieldLayout.rect.getApproximate().client,this._params.textFieldLayout.scroll.getApproximate());return{left:r.left-15,top:r.top+8}}}class j{constructor(){this._logger=Y.Y.create("TouchTypistGDocsIntegration"),this._logger.info("Touch Typist integration for GDocs")}get eventsTargetElement(){const e=(0,D.CI)(document);return e||(this._logger.error("Could not find the target element for text events"),document.body)}getCaretPosition(){return $.getCaretPositionGdocs(Z.y1)}}class N{constructor(e){this._params=e,this._logger=Y.Y.create("TouchTypistGenericIntegration"),this._logger.info("Touch Typist integration for non-GDocs"),this._caretService=new $(this._params)}get eventsTargetElement(){return document.body}getCaretPosition(e){return this._caretService.getCaretPositionGeneral(e)}}var K=r(15523),Q=r(72106);class X{constructor(e){this._getCheckingService=e,this._logger=Y.Y.create("TouchTypistCapiServiceImpl")}triggerTouchTypist(e){const t=this._getCheckingService();if(!t)return this._logger.error("Checking service is not available in touch typist"),Q.t$(new Error("Checking service is not available in touch typist"));const r={action:"trigger_touch_typist",rev:0,mode:"GEC_GRIMOIRE_RECHECK",features:[K.zV.individualPreviewReverts],textScope:e,correlationId:"touch-typist",id:1};return t.triggerTouchTypist(r),Q.F2(void 0)}}var J=r(70989);class ee{constructor(e){this._params=e,this._subs=new i.w,this._logger=Y.Y.create("TouchTypistHotkeyManagerImpl"),this._caretPosition=k.h.create(c.YP),this._subs.add(this._params.selectionOrCaretPosition.subscribe(E.wW(this._caretPosition)))}listeningToHotkeyApply(){this._subs.add(h.R(this._params.targetElement,"keydown",{capture:!0}).pipe(n.h((e=>"Tab"===e.key)),J.M(this._params.isTouchTypistActivated),a.b((([e,t])=>{t&&(e.stopImmediatePropagation(),e.preventDefault(),this._applyChanges())}))).subscribe())}_applyChanges(){this._logger.info("Apply touch typist suggestions")}dispose(){this._subs.unsubscribe()}}class te{constructor(e){this._params=e,this._logger=Y.Y.create("TouchTypistCaretPreservingReplacementServiceIml"),this._subs=new i.w}_subscribeToTextChanges(e,t,r,i){const s=((e,t,r,i)=>R.SV.translate(R.SV.rebase(R.SV.translate(e,-i.start),O.k.fromDiff(t,r)),i.start))(e,t,r,i),a=this._params.textObserver.contentChanges.async.pipe(G.q(1)).subscribe((()=>{this._params.selectionService.setSelection({start:s.start,end:s.end})}));this._subs.add(a)}_handleCaretPositionAfterReplacement(e,t,r,i){e?this._subscribeToTextChanges(e,t,r,i):this._logger.info("No initial caret given, not restoring")}canPerformReplacement(e,t){return this._params.replacementService.canPerformReplacement(e,t)}async performReplacement(e,t,r){const{pos:i,value:s}=e;if(!this.canPerformReplacement({pos:i,oldValue:t,value:s}))return A.left(new Error("Can't perform replacement at this range"));this._logger.debug("Perform replacement",{range:i,newText:s,oldText:t,initialCaretPosition:r});try{this._handleCaretPositionAfterReplacement(r,t,s,i);const a=await this._params.replacementService.performReplacement(e,{preserveFormatting:!0});return A.right(a)}catch(e){return this._logger.error("Failed to perform a replacement",e),A.left(new Error(`Failed to perform a replacement, ${e.toString()}`))}}async performBatchReplacements(e,t,r,i){const{pos:s,value:a}=t;this._logger.debug("Perform batch replacements",{newText:a,oldText:r,initialCaretPosition:i});try{this._handleCaretPositionAfterReplacement(i,r,a,s);const t=await this._params.replacementService.performBatchReplacements(e,{preserveFormatting:!0});return A.right(t)}catch(e){return this._logger.error("Failed to perform a batch replacement",e),A.left(new Error(`Failed to perform a batch replacement, ${e.toString()}`))}}dispose(){this._subs.unsubscribe()}}class re{constructor(e){this._params=e,this._subs=new i.w,this._disposables=[],this._touchTypistState=new s.X({revision:-1,previews:[],reverts:[]}),this._integration="gDocsCanvas"===this._params.integrationInfo.integrationName?new j:new N({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver}),this._logger=Y.Y.create("TouchTypistFeatureImpl"),this._touchTypistCapiService=new X(this._params.getCheckingService),this._paragraphService=new B({textObserver:this._params.textObserver,selectionOrCaretPosition:this._params.selectionOrCaretPosition,replacementListener:this._params.replacementListener}),this._replacementService=new te({replacementService:this._params.replacementService,textObserver:this._params.textObserver,selectionService:this._params.selectionService}),this._touchTypistHotkeyManager=new ee({isTouchTypistActivated:this._paragraphService.activeParagraphRange.view(c.pC),targetElement:this._integration.eventsTargetElement,replacementService:this._replacementService,selectionOrCaretPosition:this._params.selectionOrCaretPosition}),this._disposables.push(this._paragraphService,this._replacementService),this._touchTypistHotkeyManager.listeningToHotkeyApply(),this._disposables.push(this._touchTypistHotkeyManager),this._subs.add(this._paragraphService.activeParagraphRange.pipe(a.b((()=>{this._touchTypistState.next({revision:-1,previews:[],reverts:[]})})),n.h(c.pC),o.U(l.MH),o.U((e=>(this._logger.info("Send touch typist trigger event",e),this._touchTypistCapiService.triggerTouchTypist({begin:e.start,end:e.end}))))).subscribe()),this._logger.info("Touch Typist feature is initialized",this._params.integrationInfo)}dispose(){this._disposables.forEach((e=>e.dispose()))}get touchTypistUI(){return w(this._paragraphService,this._params.textFieldLayout,this._integration)}onTouchTypistTriggerResponse(e){var t;if(this._logger.debug("TouchTypist TriggerResponse received.",e),!(null===(t=e.previews)||void 0===t?void 0:t.length))return void this._logger.debug("Response has no previews.",{response:e});const r=e.rev,i=function(e){const t=e.textScope.begin;function r(e){const r=e.ops[0];return r&&q.s.isRetain(r)?{...e,ops:[{retain:t+r.retain},...e.ops.slice(1)]}:e}return e.previews.map((e=>({...e,begin:t+e.begin,end:t+e.end,delta:r(e.delta),highlight:{s:t+e.highlight.s,e:t+e.highlight.e},reverseDelta:r(e.reverseDelta)})))}(e),s=function(e){const t=e.textScope.begin;return e.reverts.map((e=>({...e,highlightBegin:t+e.highlightBegin,highlightEnd:t+e.highlightEnd})))}(e);this._touchTypistState.next({revision:r,previews:i,reverts:s})}}},55362:(e,t,r)=>{r.d(t,{$x:()=>n,F8:()=>d,Go:()=>s,Kt:()=>y,Lq:()=>l,QR:()=>E,Qy:()=>_,Vk:()=>w,Wp:()=>i,XG:()=>a,_m:()=>g,d0:()=>p,f:()=>c,gH:()=>C,gL:()=>T,gv:()=>m,ij:()=>P,j5:()=>b,jW:()=>u,lO:()=>S,os:()=>v,rx:()=>x,uj:()=>h,y1:()=>o,yw:()=>f});const i=".kix-appview-editor",s=".docos-input",a=".docs-texteventtarget-iframe",n=".kix-cursor",o=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',p="#docs-toolbar-mode-switcher",h="edit-mode",g="suggest-mode",u="#titlebar-mode-indicator-container .titlebar-request-access-button",d="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",m=".kix-canvas-tile-content",C="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",_=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",f=".kix-page-paginated",v=".kix-page-paginated.canvas-first-page",b=".docs-horizontal-ruler",y=".docs-vertical-ruler",w="#fontSizeSelect input",T=".docs-ruler-background",x=".docs-ruler-background-inner",S=".docs-ruler-indent-first-line",P=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'}}]);