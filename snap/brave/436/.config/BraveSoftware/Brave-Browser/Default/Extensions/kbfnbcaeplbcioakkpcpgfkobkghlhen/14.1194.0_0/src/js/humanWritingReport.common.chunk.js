(self.webpackChunk=self.webpackChunk||[]).push([[5739],{56195:(e,t,n)=>{n.d(t,{OX:()=>s,QU:()=>r,Uv:()=>a,XW:()=>o,bd:()=>c,yx:()=>i});const i="https://pslgzvcvzk.execute-api.us-east-1.amazonaws.com/",a=2,r=92,s=1,o=["chat.openai.com","gemini.google.com","www.perplexity.ai","perplexity.ai","chatgpt.com","www.wikipedia.org",".wikipedia.org"],c=1e4},24310:(e,t,n)=>{n.r(t),n.d(t,{EditsTrackingControllerImpl:()=>bt});var i,a,r,s,o=n(90023),c=n(82823),l=n(65647),d=n(55446),h=n(60841),u=n(73863),p=n(78488),m=n(58303),g=n(63843),_=n(25770),f=n(8754),b=n(42818),v=n(62617),k=n(45661),S=n(46356),y=n(66241),w=n(72616),C=n(48822),x=n(64965),I=n(70163),E=n(36072),T=n(70989),A=n(74857),D=n(14765),P=n(78008),G=n(16692);!function(e){let t;!function(e){e.create=function(e){return{timestamp:e.timestamp,delta:e.delta,copyContentId:e.sourceContentId}},e.parse=function(e){try{const t=e;return t.timestamp&&!isNaN(t.timestamp)&&t.delta?{timestamp:Number(t.timestamp),delta:t.delta,sourceContentId:t.copyContentId?String(t.copyContentId):void 0}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(i||(i={})),function(e){let t;!function(e){e.create=function(e){return{timestamp:e.timestamp,text:e.char,copiedContentId:void 0!==e.sourceContentId&&null!==e.sourceContentId&&""!==e.sourceContentId?e.sourceContentId:void 0,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return void 0!==t.text&&t.text.length&&t.timestamp&&void 0!==t.isSelfAuthored?{char:String(t.text),timestamp:Number(t.timestamp),sourceContentId:t.copiedContentId?String(t.copiedContentId):void 0,isSelfAuthored:Boolean(t.isSelfAuthored)}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(a||(a={})),function(e){let t;e.create=function(e,t,n,i,a){let r=[],s=[],o=[];return i&&((0,g.kG)(n.length==i.length,`Expected that the text length ${n.length} be the same as the Char[] length ${i.length}`),r=i.map((e=>e.timestamp)),s=i.map((e=>e.isSelfAuthored)),o=i.map((e=>e.sourceContentId||null))),{id:crypto.randomUUID(),url:e,sourceName:t,text:n,timestamps:r,isSelfAuthoredTags:s,originalSourceContentIds:o,prompt:a}},function(e){e.create=function(e){return{id:e.id,url:e.url,sourceName:e.sourceName,text:e.text,timestamps:e.timestamps,isSelfAuthoredTags:e.isSelfAuthoredTags,originalCopiedContentIds:e.originalSourceContentIds,prompt:e.prompt||null}},e.parse=function(e){try{const t=e;if(t.id&&t.url&&t.sourceName&&t.text&&Array.isArray(t.timestamps)&&Array.isArray(t.isSelfAuthoredTags)&&Array.isArray(t.originalCopiedContentIds)){const e=t.timestamps.filter((e=>!isNaN(e))),n=t.isSelfAuthoredTags.map(Boolean),i=t.originalCopiedContentIds.filter((e=>null===e||"string"==typeof e));return e.length===n.length&&n.length===i.length?{id:t.id,url:t.url,sourceName:t.sourceName,text:t.text,timestamps:e,isSelfAuthoredTags:n,originalSourceContentIds:i,prompt:t.prompt||void 0}:null}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(r||(r={})),function(e){let t,n;e.empty=function(e){return{id:e,chars:[],sourcedContentStore:{kind:"internal",data:[]},deltaEdits:[]}},function(e){e.create=function(e){return{id:e.id,chararray:e.chars.map(a.Legacy.create),copyStore:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(r.Legacy.create)},deltas:e.deltaEdits.map(i.Legacy.create)}},e.parse=function(e){try{const t=e;if(t.id&&Array.isArray(t.chararray)&&t.copyStore&&t.copyStore.storeType&&Array.isArray(t.copyStore.data)&&Array.isArray(t.deltas)){const e=t.chararray.map(a.Legacy.parse).filter(a.is),n=t.copyStore.data.map(r.Legacy.parse).filter(r.is),s=t.deltas.map(i.Legacy.parse).filter(i.is);return e.length!==t.chararray.length||n.length!==t.copyStore.data.length||s.length!==t.deltas.length?null:{id:t.id,chars:e,sourcedContentStore:{kind:t.copyStore.storeType,data:n},deltaEdits:s}}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e,t,n,s){return{chararray:e.chars.map(a.Legacy.create),copy_store:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(r.Legacy.create)},deltas:e.deltaEdits.map(i.Legacy.create),document_title:n,document_url:s,last_updated_at:t}}}(n=e.Backend||(e.Backend={}))}(s||(s={}));var R=n(88241);const L="document_state";class B{constructor(e,t,n,i){this.uniqId=e,this.onReadSuccess=t,this.onReadError=n,this.onWriteResult=i,this._log=R.Y.create("HWRStorage"),this.reload()}reload(){const e=indexedDB.open("human_writing_report",1);this._request=e,e.onsuccess=t=>{this._db=e.result,this._log.info("openDb DONE");const n=this._db.transaction([L],"readonly").objectStore(L).get(this.uniqId);n.onerror=e=>{this.onReadError()},n.onsuccess=e=>{const t=n.result;if(t){const e=s.Legacy.parse(t);e?this.onReadSuccess(e):this.onReadError()}else this.onReadError()}},e.onerror=t=>{this._log.error("openDb:",e.error)},e.onupgradeneeded=e=>{this._log.info("openDb.onupgradeneeded");const t=e.target.result;[L].forEach((e=>{t.createObjectStore(e,{keyPath:"id",autoIncrement:!1})}))}}writeDocumentState(e){const t=this._db.transaction([L],"readwrite").objectStore(L).put(s.Legacy.create(e));t.onerror=e=>{this.onWriteResult("error")},t.onsuccess=e=>{this.onWriteResult("success")}}}var U=n(43534),O=n(56195),N=n(72525),M=n(39408),j=n(87175);class F{constructor(){this._rpc=(0,k.OB)().bgRpc,this._log=R.Y.create("GoogleDocsSourcedContentStore")}async getMatch(e,t,n){let i=null;return v.QY.getNumInsertedLetters(t)>=O.Uv&&v.QY.getNumDeletedLetters(t)>0&&(e.endsWith(" ")||e.endsWith("\n"))?i=r.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e):0==v.QY.getNumDeletedLetters(t)&&v.QY.getNumInsertedLetters(t)>=O.Uv&&v.QY.getNumInsertedLetters(t)<=O.QU&&(i=await this._matchPhraseCompletion(e,n)),this._log.debug(`[GoogleDocsSuggestionStore] getMatch('${e}') returning:`,i),i}async _matchPhraseCompletion(e,t){let n=null,i=null;if(null!=this._rpc.api.autocompletePhrase&&(i=await this._rpc.api.autocompletePhrase(t)),null!=i){const t=i.text.substring(i.prefixBegin-i.textBegin,i.prefixEnd-i.textBegin),a=i.text.substring(i.prefixEnd-i.textBegin),s=i.text.substring(t.length);(a==e||a.startsWith(e)||e.startsWith(a))&&(this._log.debug(`[GoogleDocsSuggestionStore] match: ${e} response: ${s}`),n=r.create("hwr://delta/rewrite/google/completion/","Google Docs Smart Compose Suggestions",e))}return n}}var z,$=n(57904);!function(e){e.Internal="internal",e.Selection="selection",e.GrammarlyPrevious="grammarly-previous",e.GrammarlyCurrent="grammarly-current",e.External="external",e.GDocs="gdocs",e.Startup="startup",e.Temporary="temporary",e.Test="test"}(z||(z={}));class Y{constructor(e,t=[],n=1/0){this.kind=e,this.data=t,this._maxRecordsCount=n,this._sourcedContentById=new Map,this.data.forEach((e=>{this._sourcedContentById.set(e.id,e)})),this._log=R.Y.create(`[${this.kind}] ${Y.name}`),this._keepLastN()}getMatch(e,t){var n;let i=this.data;t&&(i=this.data.filter(t));const a=i.find((({text:t})=>t===e))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getMatch('${(0,v.aS)(e,40)}') returning:`,a),a}getFuzzyMatch(e,t){var n;const i=(1-t)*e.length,a=this.data.find((t=>{var n,a;const r=(0,v.CZ)(t.text),s=$.zI.diffAsChanges(r,e);return null===(n=this._log)||void 0===n||n.info(`[FuzzyMatch] text length: ${e.length}, amount changed: ${s.amount}`),null===(a=this._log)||void 0===a||a.info("Delta",s),s.amount<=i&&!v.Hq.hasPerLetterTags(t)}))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getFuzzyMatch('${(0,v.aS)(e,40)}') returning:`,a),a}getContentById(e){return this._sourcedContentById.get(e)||null}addContent(e){var t;null===(t=this._log)||void 0===t||t.info("addContent",e),this.data.push(e),this._sourcedContentById.set(e.id,e),this._keepLastN()}_keepLastN(){this.data.length<=this._maxRecordsCount||(this.data.slice(0,this.data.length-this._maxRecordsCount).forEach((({id:e})=>{this._sourcedContentById.delete(e)})),this.data=this.data.slice(-this._maxRecordsCount))}}class Z{constructor(e,t,n,i){this.text=e,this.delta=t,this.timestamp=n,this.sourcedContent=i,null!=i&&i.timestamps.length>0&&((0,g.kG)(e.length==i.timestamps.length),(0,g.kG)(e.length==i.isSelfAuthoredTags.length),(0,g.kG)(e.length==i.originalSourceContentIds.length))}getCharAt(e){var t,n,i;const a=null!=this.sourcedContent?this.sourcedContent.timestamps:[],r=(null===(t=this.sourcedContent)||void 0===t?void 0:t.isSelfAuthoredTags)||[],s=(null===(n=this.sourcedContent)||void 0===n?void 0:n.originalSourceContentIds)||[];let o=this.timestamp,c=v.QY.getNumInsertedLetters(this.delta)<=O.OX,l=(null===(i=this.sourcedContent)||void 0===i?void 0:i.id)||null;return a.length>0&&(o=a[e],c=c||r[e],l=s[e]||l),{char:this.text[e],timestamp:o,sourceContentId:l||void 0,isSelfAuthored:c}}}class V{constructor(e,t){this._documentId=e,this._events=t,this._chars=[],this._last_updated_at=Date.now(),this._log=R.Y.create("ChangeTrackerImpl"),this._deltaEdits=[],this._internalCopyStore=new Y(z.Internal,[]),this._internalSelectionStore=new Y(z.Selection),this._prevGrammarlyAlerts=new Y(z.GrammarlyPrevious),this._currentGrammarlyAlerts=new Y(z.GrammarlyCurrent),this._externalCopyStore=new Y(z.External,[],4),this._googleDocsSourcedContentStore=new F,this.startupCopyStore=new Y(z.Startup,[],4)}updateKnownDocumentState(e,t){this._chars=e.chars,this._internalCopyStore=new Y(z.Internal,e.sourcedContentStore.data),this._deltaEdits=e.deltaEdits;const n=v.QY.singleDelta(e.chars.map((e=>e.char)).join(""),t);return n.forEach((e=>{U.s.isInsertString(e)&&this.startupCopyStore.addContent(r.create("hwr://delta/startup/","Delta on Document load",e.insert))})),this._log.info("Current state differs from saved by:",n),this.onTextChange(n)}async onTextChange(e){if(this._log.info("Got text change",e),0===e.ops.length)return void this._log.info("Noop change, skipping");const t=U.s.normalizeDelta(U.s.cleanAllAttrs(e));this._log.info("Squashed delta",t);const n=Date.now(),i=await this._applyDelta(t,n),a=v.QY.getNumInsertedLetters(t);if(a>O.OX&&i){const e=this._internalCopyStore.getContentById(i);e?this._events.next({kind:"sourcedTextAdded",sourceDomain:e.sourceName,textLength:a,promptDetected:Boolean(e.prompt)}):this._events.next({kind:"unknownSourceTextAdded",textLength:a})}else this._events.next({kind:"unknownSourceTextAdded",textLength:a});const r={timestamp:n,delta:t,sourceContentId:i||void 0};this._deltaEdits.push(r),this._last_updated_at=Date.now()}onSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._internalSelectionStore.addContent(r.create(self.location.href,self.name||"Unnamed",t,n)),this._events.next({kind:"sourceAdded",textLength:e.end-e.start,sourceDomain:self.location.origin,promptDetected:!1}),this._log.debug("HWR Selected Text:",{selectedText:t,selection_info:n})}}))}onAlertChange(e){this._log.debug("onAlertChange",e);const t=new Y(z.Temporary);for(const[n,i]of Object.entries(e)){if(void 0===i||!M.S.isCapiAlert(i))continue;const e=i.text;i.replacements.forEach((i=>{const a=v.QY.extractMaximalReplacementString(e,v.QY.singleDelta(e,i));a&&a.length>=O.Uv&&(this._log.debug("adding alert to store","Grammarly edited: ("+e+" -> "+i+")"),t.addContent(r.create("hwr://delta/rewrite/grammarly/correct/?id="+n,"Grammarly edited: ("+e+" -> "+i+")",a)))}))}v.Hq.eq(t.data,this._currentGrammarlyAlerts.data)||(this._prevGrammarlyAlerts=new Y(z.GrammarlyPrevious,this._currentGrammarlyAlerts.data),this._currentGrammarlyAlerts=new Y(z.GrammarlyCurrent,t.data))}addCopiedTextToExternalStore(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(t)&&this._externalCopyStore.addContent(r.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}onReplacementApplied(e,t){if(this._log.debug("HWR replacement applied",{source:e,replacement:t}),e===j.P.snippets||e===j.P.oggyGenAI){let n="";void 0!==t.pos&&(n=this._chars.slice(t.pos.start,t.pos.end).map((e=>e.char)).join(""));const i=v.QY.extractMaximalReplacementString(n,"string"==typeof t.value?v.QY.singleDelta(n,t.value):t.value);i&&i.length>=O.Uv&&this._internalCopyStore.addContent(r.create("hwr://delta/rewrite/grammarly/"+e,"Grammarly generated ("+e+")",i))}}getDocumentState(){return{id:this._documentId,chars:this._chars,sourcedContentStore:{kind:"internal",data:this._internalCopyStore.data},deltaEdits:this._deltaEdits}}getReportableDocument(){return s.Backend.create(this.getDocumentState(),this._last_updated_at,document.title,self.location.href)}getTextInfoForAlert(e){const t=[];return(0,N.C)(e).forEach((e=>{if("transform"==e.meta.rangePurpose)for(let n=e.start;n<e.end;++n)t.push({...this._chars[n]})})),t}_applySingleDeletion(e,t){this._chars.splice(e,t)}_applySingleInsertion(e,t){const n=t.text.length,i=Array.from({length:n},((e,n)=>t.getCharAt(n)));this._chars.splice(e,0,...i)}async _searchAllCopyStores(e,t,n){let i=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url));return i?{storeKind:this._internalCopyStore.kind,sourcedContent:i}:(i=this._internalSelectionStore.getMatch(e),i?{storeKind:z.Selection,sourcedContent:i}:(i=this._prevGrammarlyAlerts.getMatch(e),i?{storeKind:z.GrammarlyPrevious,sourcedContent:i}:(i=this._externalCopyStore.getMatch(e),i?{storeKind:z.External,sourcedContent:i}:(i=await this._googleDocsSourcedContentStore.getMatch(e,t,n),i?{storeKind:z.GDocs,sourcedContent:i}:(i=this.startupCopyStore.getMatch(e),i?{storeKind:z.Startup,sourcedContent:i}:(i=this._externalCopyStore.getFuzzyMatch(e,.95),i?{storeKind:z.External,sourcedContent:i}:null))))))}async _applyDelta(e,t){let n=null,i=0;const a=this._chars.map((e=>e.char)).join(""),r=v.QY.extractMaximalReplacementString(a,e),s=(0,o.zG)(U.s.rangeOfTheChange(e),m.UI((([e])=>a.substring(0,e))),m.fS((()=>a))),c=r?await this._searchAllCopyStores(r,e,s):null;n=(null==c?void 0:c.sourcedContent.id)||null,c&&c.storeKind!=z.Internal&&this._internalCopyStore.addContent(c.sourcedContent),this._log.info("Content search result",c);for(const n of e.ops)U.s.isRetain(n)?i+=n.retain:U.s.isInsertString(n)?(this._applySingleInsertion(i,new Z(n.insert,e,t,(null==c?void 0:c.sourcedContent)||null)),i+=n.insert.length):U.s.isDelete(n)&&(this._trackDeletion(i,n.delete),this._applySingleDeletion(i,n.delete));return n}_trackDeletion(e,t){const n=Array.from({length:t},((t,n)=>this._chars[e+n])),i=n.map((e=>e.char)).join("");this._onCopyDelete(i,n)}_onCopyDelete(e,t){e.length>=O.Uv&&this._internalCopyStore.addContent(r.create(self.location.href,self.name||"Unnamed",e,t))}onCopy(e){e.forEach((e=>{if(e.start!=e.end){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._onCopyDelete(t,n)}}))}_getCSSFormatForLetter(e){const t="color: red;",n="color: black;",i=e.sourceContentId,a=null!=i?this._internalCopyStore.getContentById(i):null;let r;return r=null!=a?a.url.match(/delta\/rewrite\/grammarly\/(oggyGenAI|snippets)/)?"color: blue;":a.url.match("delta/rewrite/grammarly/correct")?"color: green;":a.url.match(/(chat.openai.com|chatgpt.com)/)?"color: purple;":a.url.match("gemini.google.com")?"color: orange;":a.url.match("delta/rewrite/google")?"color: teal;":a.url.match("delta/startup")?t:e.isSelfAuthored?n:t:e.isSelfAuthored?n:t,r}_logText(){const e=this._chars.map((e=>`%c${e.char}`)).join(""),t=this._chars.map((e=>this._getCSSFormatForLetter(e)));self.console.log(`HWR: ${e}`,...t)}}class H{constructor(e,t,n,i,a,r,o){this._listenerId=e,this._alertsState=t,this._textObserver=n,this._selectionSource=i,this._CSState=a,this._replacementListener=r,this._events=o,this._subs=new C.L,this._trackingState=_.h.create("dormant"),this._documentRetrievalState=_.h.create("waiting"),this._log=R.Y.create("HWRListenerImpl"),this._documentVisibilityObs=x.R(document,"visibilitychange").pipe(I.B()),this._documentStateSubj=new E.xQ,this._writeToStorageRequestSubj=new E.xQ,this._log.info("Document id",e);const c=new G.m;this._documentId=c.documentID||this._listenerId,this._changeTracker=new V(this._documentId,o),this._hwrStorage=new B(this._documentId,(e=>{this._documentStateSubj.next(e)}),(()=>{this._documentStateSubj.next(s.empty(this._documentId))}),(e=>{this._log.info(`[On Write] Status: ${e}`)})),this._log.info("HWR Storage",this._hwrStorage),this._changeTracker.addCopiedTextToExternalStore(this._CSState.view("copiedTextMessage").get()),this._setupEventHandlers()}get changeTracker(){return this._changeTracker}get documentId(){return this._documentId}_setupEventHandlers(){this._subs.add(this._replacementListener.obs.pipe(T.M(this._trackingState),d.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onReplacementApplied(e.source,e.replacement)}))),this._subs.add(this._alertsState.pipe(T.M(this._trackingState),d.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onAlertChange(e)}))),this._subs.add(this._textObserver.contentChanges.async.pipe(T.M(this._trackingState),d.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._handleTextChange(e)}))),this._subs.add(this._selectionSource.data.changes.pipe(T.M(this._trackingState),d.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onSelectionChange(e)}))),this._subs.add(this._writeToStorageRequestSubj.pipe(A.b(1e3)).subscribe((()=>this._writeToStorage()))),this._documentVisibilityObs.pipe(l.U((()=>document.hidden))).subscribe((e=>{e?this._stopTrackingWhenHidden():this._resumeTrackingWhenVisible()})),this._subs.add(this._documentStateSubj.pipe(T.M(this._documentVisibilityObs.pipe(l.U((()=>document.hidden)),D.O(document.hidden)))).subscribe((([e,t])=>{t||this._handleDocumentStateChange(e)})))}startTracking(){this._trackingState.set("active")}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused")}getReportableDocument(){return this._documentRetrievalState.pipe(d.h((e=>"ok"===e)),u.q(1),P.V(2e3),l.U((()=>this._changeTracker.getReportableDocument()))).toPromise()}_stopTrackingWhenHidden(){this._log.info("Pausing document tracking while document is not visible"),this._trackingState.modify((e=>"active"===e?"dormant":e))}_resumeTrackingWhenVisible(){this._log.info("Resuming document tracking after document became visible"),this._trackingState.modify((e=>"paused"===e?e:"active")),this._documentRetrievalState.set("waiting"),this._hwrStorage.reload()}async _handleDocumentStateChange(e){this._log.info("Get saved or Empty document.",e);const t=v.QY.singleDelta(e.chars.map((e=>e.char)).join(""),this._textObserver.getCurrentTextMap().getPlainText());v.QY.isNoTextChangesDelta(t)?this._events.next({kind:"knownStateMatch"}):this._events.next({kind:"knownStateMismatch",lengthDifference:Math.abs(v.QY.getNumInsertedLetters(t)+v.QY.getNumDeletedLetters(t))}),await this._changeTracker.updateKnownDocumentState(e,this._textObserver.getCurrentTextMap().getPlainText()),this._documentRetrievalState.set("ok"),this._writeToStorage()}_writeToStorage(){this._hwrStorage.writeDocumentState(this._changeTracker.getDocumentState())}_handleTextChange(e){this._log.info("HWR text data: ",e);const t=this._CSState.view("copiedTextMessage").get();this._log.info("Most Recent Copied Text: ",t),this._changeTracker.addCopiedTextToExternalStore(t);const n=v.QY.singleDelta(e.prevText,e.newText);this._log.info("HWR single delta: ",n),n.ops.length>0&&this._changeTracker.onTextChange(n).then((()=>{this._writeToStorageRequestSubj.next()}))}dispose(){this._subs.unsubscribe(),this._writeToStorage()}}var W=n(49231),q=n(63469),Q=n(8748),K=n(65802),X=n(52811),J=n(99793),ee=n(45689),te=n(24291),ne=n(6505),ie=n(2574),ae=n(4535),re=n(48868),se=n(66712),oe=n(85863),ce=n(63640),le=n(12863),de=n(5470),he=n(58618);const ue={$nest:{"&&":{marginLeft:ne.ux.rem(.25),verticalAlign:"top",position:"absolute"}}},pe={position:"absolute",left:ne.ux.rem(1),top:ne.ux.rem(1),width:ne.ux.rem(5.1875),height:ne.ux.rem(5.1875/4.61)},me=ne.ux.stylesheet({tag:[ue],logo:[pe],link:[{whiteSpace:"normal"}]}),ge=ee.UI.Node.make((({notify:e})=>W.createElement(ie.u_,{isOpen:!0,onClose:e({kind:"closeOptInPopup"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog"},W.createElement(ie.u_.Body,null,W.createElement(he.o,null,W.createElement(ae.c,{className:me.logo}),W.createElement(re.k,{direction:"column",gap:6},W.createElement(re.k,{direction:"column",gap:4},W.createElement(se.X,{as:"h1",align:"center"},"Verify authorship",W.createElement(oe.V,{variant:"addition",label:"Beta",inline:!0,className:me.tag}),W.createElement("br",null),"and content authenticity"),W.createElement(ce.x,{as:"p",align:"center"},"Grammarly Authorship helps you verify that you are the author of your documents. If you are ever questioned about text authenticity, just present your Authorship Report."," ",W.createElement(le.r,{href:"https://www.grammarly.com",variant:"secondary"},"Tell me more..."))),W.createElement(re.k,{direction:"row",gap:4,justify:"center"},W.createElement(de.z,{text:"Enable Grammarly Authorship",onClick:e({kind:"enable"})}),W.createElement(de.z,{variant:"ghost",text:"I don't need this",onClick:e({kind:"optOut"})})),W.createElement(ce.x,{as:"p",color:"base-subdued",variant:"text-small"},"By enabling Grammarly Authorship, you agree to the"," ",W.createElement(le.r,{href:"https://www.grammarly.com/terms",variant:"secondary",className:me.link},"Terms and Conditions")," ","and"," ",W.createElement(le.r,{href:"https://www.grammarly.com/privacy-policy",variant:"secondary",className:me.link},"Privacy Policy"),". California residents, see our"," ",W.createElement(le.r,{href:"https://www.grammarly.com/supplemental-california-privacy-disclosures",variant:"secondary",className:me.link},"CA Privacy Notice"),"."))))))),_e=ee.UI.Union.asOption(ge);var fe=n(45685),be=n(99627);const ve=ne.ux.stylesheet({toast:[{$nest:{"&&":{minWidth:"376px"}}}]}),ke=ee.UI.Node.make((({notify:e})=>W.createElement(fe.F,{variant:"success",text:"Grammarly is tracking your writing activity in this document. Click the icon to stop tracking or see your report.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:ve.toast}))),Se=(0,be.xb)(fe.F),ye=ee.UI.Node.make((({view:e,notify:t})=>W.createElement(Se,{variant:"success",text:e("domain").pipe(l.U((e=>`Track writing activity will start automatically ${"docs.google.com"===e?"in all new Google Documents":`on ${e} domain`}.`))),onClose:t({kind:"dismissToast"}),onMouseEnter:t({kind:"toastHover",hovered:!0}),onMouseLeave:t({kind:"toastHover",hovered:!1}),className:ve.toast}))),we=ee.UI.Node.make((({notify:e})=>W.createElement(fe.F,{variant:"success",text:"Grammarly Authorship is turned off.",primaryAction:W.createElement(de.z,{text:"OK",variant:"primary",onClick:e({kind:"optOutToastOkClick"})}),secondaryAction:W.createElement(de.z,{text:"Go back",variant:"ghost",onClick:e({kind:"optOutToastGoBackClick"})}),onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:ve.toast}))),Ce=ee.UI.Node.make((({notify:e})=>W.createElement(fe.F,{variant:"critical",text:"Could not generate Authorship Report. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:ve.toast}))),xe=ee.UI.Union.make("kind",{documentTrackingStarted:ke,domainTrackingStarted:ye,optedOut:we,reportGenerationFailed:Ce}),Ie=ee.UI.Union.asOption(xe);var Ee=n(7545),Te=n(43818);const Ae=ne.ux.keyframes({"0%":{transform:"scale(1)",opacity:.5},"75%":{transform:"scale(6)",opacity:0},"100%":{transform:"scale(6)",opacity:0}}),De={width:ne.ux.rem(.5),height:ne.ux.rem(.5),borderRadius:ne.ux.rem(.25),position:"relative",backgroundColor:Ee.I.Background.Brand.Default,overflow:"visible",$nest:{"&:before":{content:"' '",width:"100%",height:"100%",borderRadius:"50%",position:"absolute",backgroundColor:Ee.I.Background.Brand.Default,top:0,left:0,transformOrigin:"50% 50%",animationName:Ae,animationDuration:"1.5s",animationIterationCount:"infinite",animationDirection:"normal",animationFillMode:"backwards"}}},Pe=ne.ux.stylesheet({dot:[De]}),Ge=()=>W.createElement("div",{className:Pe.dot}),Re=()=>W.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},W.createElement("path",{d:"M14 20a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0-1a5 5 0 1 0-.001-10.001A5 5 0 0 0 14 19Zm-2-7.7c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088a.305.305 0 0 1 .084.212v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088A.305.305 0 0 1 12 16.7v-5.4Zm2.857 0c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088A.305.305 0 0 1 16 11.3v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088.305.305 0 0 1-.084-.212v-5.4Z",fill:"inherit"}),W.createElement("path",{d:"M6.964 14.924a6.912 6.912 0 0 1-.726-.148v-1.963a.425.425 0 1 0-.85-.001v1.683a7.013 7.013 0 0 1-2.651-1.881V8a5.264 5.264 0 0 1 10.426-1.025 6.987 6.987 0 0 0-.886.161A4.364 4.364 0 0 0 3.638 8v3.5a.425.425 0 1 0 .85 0V8a3.512 3.512 0 0 1 6.972-.608 7.066 7.066 0 0 0-.856.395A2.612 2.612 0 0 0 5.388 8v2.625a.425.425 0 1 0 .85 0V8a1.762 1.762 0 0 1 3.524 0v.325a7.057 7.057 0 0 0-2.798 6.599Zm7.054-7.998A6.113 6.113 0 0 0 1.888 8v3.412A7.004 7.004 0 0 1 8 1a7.005 7.005 0 0 1 6.927 5.986 7.166 7.166 0 0 0-.909-.06ZM7.575 8v.75a.425.425 0 1 0 .85 0V8a.425.425 0 1 0-.85 0Z",fill:"#027e6f"})),Le=()=>W.createElement("svg",{viewBox:"0 0 20 20",fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},W.createElement("path",{d:"M4 15.289V10a6 6 0 1 1 12 0v5.289a7.98 7.98 0 0 1-1 .954V13a.5.5 0 0 0-1 0v3.928c-.32.186-.654.349-1 .49V10a3 3 0 1 0-6 0v3a.5.5 0 0 0 1 0v-3a2 2 0 1 1 4 0v7.748a8.062 8.062 0 0 1-1.5.237V13.5a.5.5 0 0 0-1 0v4.485a8.062 8.062 0 0 1-1.5-.237V15.5a.5.5 0 0 0-1 0v1.918a8.022 8.022 0 0 1-3-2.129Zm10.474-4.29L14.5 11l.021-.003c.096-.016.479-.105.479-.508V10a5 5 0 0 0-10 0v4.5a.5.5 0 0 0 1 0V10a4 4 0 0 1 8 0l.5.5-.5-.5v.5a.5.5 0 0 0 .474.499ZM3 13.873A7.954 7.954 0 0 1 2 10c0-4.415 3.585-8 8-8a8.004 8.004 0 0 1 7 11.874V10a7 7 0 1 0-14 0v3.873ZM9.5 10v1a.5.5 0 0 0 1 0v-1a.5.5 0 0 0-1 0Z",fill:"inherit"})),Be={$nest:{svg:{width:ne.ux.rem(1.25),height:ne.ux.rem(1.25),fill:Ee.I.Icon.Brand.Default}}},Ue={position:"absolute",right:ne.ux.rem(-.25),top:ne.ux.rem(-.25)},Oe=ne.ux.stylesheet({icon:[Be],button:[{background:"none",border:"none",cursor:"pointer",position:"relative"}],attractSequnce:[Ue]}),Ne=ee.UI.Node.make((({view:e,notify:t,state:n})=>W.createElement(W.Fragment,null,W.createElement(Te.F.button,{className:Oe.button,"aria-label":e("trackingState").pipe(l.U((e=>"tracking"===e?"Press to pause authorship tracking":"Press to start authorship tracking"))),onClick:t({kind:"trackingButtonClick"})},W.createElement(Te.F.div,{className:Oe.icon},e("trackingState").pipe(l.U((e=>"tracking"===e?W.createElement(Re,null):W.createElement(Le,null)))),n.pipe(l.U((({optInPopupWasClosedOnce:e,trackingState:t})=>!e&&"available"===t&&W.createElement("div",{className:Oe.attractSequnce},W.createElement(Ge,null))))))))));var Me=n(57365),je=n(5305),Fe=n(32522),ze=n(40478),$e=n(63716),Ye=n(10779),Ze=n(85101),Ve=n(22328),He=n(42530),We=n(43784);const qe=()=>W.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},W.createElement("path",{d:"M8.268 13.011a.5.5 0 0 1-.768-.422V7.411a.5.5 0 0 1 .768-.422l4.07 2.59a.5.5 0 0 1 0 .843l-4.07 2.589ZM9.8 2.283c-4.3 0-7.8 3.5-7.8 7.8 0 4.301 3.5 7.8 7.8 7.8s7.8-3.499 7.8-7.8c0-4.3-3.5-7.8-7.8-7.8Z",fill:"inherit"})),Qe=()=>W.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},W.createElement("path",{d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm5.538-4.062a.615.615 0 0 0-.615.616v6.892c0 .34.276.616.615.616h.616a.613.613 0 0 0 .615-.616V6.554a.616.616 0 0 0-.615-.616h-.616Zm4.308 0a.613.613 0 0 0-.615.616v6.892c0 .34.276.616.615.616h.615a.615.615 0 0 0 .616-.616V6.554a.616.616 0 0 0-.616-.616h-.615Z",fill:"inherit"})),Ke={boxShadow:Me.H8.boxShadow,border:Me.H8.border,background:Ee.I.Background.Base.Default,borderRadius:ne.ux.rem(.5)},Xe={position:"absolute",bottom:"100%",marginBottom:ne.ux.rem(je.F2),background:Ee.I.Background.Base.Default,boxShadow:Me.H8.boxShadow,border:Me.H8.border,borderRadius:ne.ux.rem(Fe.xB),whiteSpace:"nowrap"},Je={$nest:{svg:{width:ne.ux.rem(1.25),height:ne.ux.rem(1.25),fill:Ee.I.Icon.Base.Inverse,stroke:"none"}}},et={$nest:{svg:{width:ne.ux.rem(1.25),height:ne.ux.rem(1.25),fill:Ee.I.Icon.Brand.Default,stroke:"none"}}},tt=ne.ux.stylesheet({container:[Ke],settingsButton:[{alignSelf:"inherit"}],logButtonContainer:[{position:"relative"}],menu:[Xe],logButton:[Je],pauseButton:[et],infoIcon:[{$nest:{"&&":{cursor:"default"}}}],switch:[{transform:"scale(0.86) translateY(0.5px)",transformOrigin:"center right",width:"160px",whiteSpace:"nowrap",display:"flex",flexDirection:"row-reverse",overflow:"visible"}]}),nt=({onClick:e})=>W.createElement(de.z,{className:tt.logButton,onClick:e,width:"full"},W.createElement(re.k,{direction:"row",gap:2,align:"center"},W.createElement(Le,null),W.createElement(ce.x,{as:"span",weight:"bold",variant:"text-small"},"Track writing activity"))),it=({isPaused:e,onPauseClick:t,onResumeClick:n,onViewReportClick:i})=>W.createElement(re.k,{direction:"row",gap:2,align:"center"},W.createElement(de.z,{variant:"secondary",className:tt.pauseButton,onClick:e?n:t,width:"full"},W.createElement(re.k,{direction:"row",gap:2,align:"center"},e?W.createElement(qe,null):W.createElement(Qe,null),W.createElement(ce.x,{as:"span",weight:"bold",variant:"text-small"},e?"Resume tracking":"Stop tracking"))),W.createElement(de.z,{text:"See report",onClick:i,width:"full"})),at=ee.UI.Node.make((({notify:e,state:t})=>W.createElement(We.d,{onClickAway:e({kind:"trackingButtonClickAway"})},W.createElement(re.k,{direction:"column",padding:2,gap:2,className:tt.container},W.createElement(re.k,{direction:"row",gap:2,align:"center"},W.createElement(ze.J,{icon:$e.H,accessibilityLabel:"Grammarly",size:"small"}),W.createElement(ce.x,{as:"span",variant:"text-xsmall",color:"base-subdued"},"Authorship"),W.createElement(Te.F.Fragment,null,t.pipe(l.U((({enabledForDomain:t,domain:n})=>W.createElement(re.k,{direction:"row",gap:1,align:"center"},W.createElement("div",{className:tt.switch},W.createElement(Ye.r,{label:"Start automatically",size:1,defaultSelected:t,onChange:t=>e({kind:t?"enableForDomain":"resetForDomain"})()})),W.createElement(Ze.h,{className:tt.infoIcon,accessibilityLabel:`Enable to start logging automatically on ${n}`,icon:Ve.r,variant:"tertiary",onClick:He.EI,isDisabled:!0}))))))),W.createElement(Te.F.Fragment,null,t.pipe(l.U((({trackingState:t})=>"available"===t||"newDocument"===t?W.createElement(nt,{onClick:e({kind:"start"})}):W.createElement(it,{isPaused:"paused"===t,onResumeClick:e({kind:"resume"}),onPauseClick:e({kind:"pause"}),onViewReportClick:e({kind:"viewReport"})}))))))))),rt=ee.UI.Union.make("state",{compact:Ne,expanded:at}),st=ee.UI.Union.asOption(rt),ot=ee.UI.Grid.make((({slots:e})=>W.createElement("div",{"data-grammarly-part":"human-writing-report-button",style:{position:"fixed",left:"20px",bottom:"20px",zIndex:1e4}},e.optInPopup,e.trackingButton,W.createElement("div",{style:{position:"absolute",left:"100%",bottom:0}},e.toast)))),ct=ee.UI.Knot.make(ot,{trackingButton:st,optInPopup:_e,toast:Ie}),lt=ee.UI.Union.asOption(ct);var dt=n(20715);function ht(e,t){return ee.Z.composeUnion({documentTrackingStarted:ee.Z.fromSideEffect((e=>{t.next({...e})}),dt.of(null)),domainTrackingStarted:ee.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(q.oA,l.U((({domain:e})=>({domain:e}))))),optedOut:ee.Z.fromSideEffect((e=>{t.next({...e})}),dt.of(null)),reportGenerationFailed:ee.Z.fromSideEffect((e=>{t.next({...e})}),dt.of(null))},(()=>e.pipe(q.oA,K.j("toast"),q.oA,l.U((e=>({kind:e}))))))}function ut(e,t){return ee.Z.composeUnion({None:()=>dt.of(null),Some:ee.Z.composeKnot({value:ht(e,t)})},(()=>e.pipe(q.oA,K.j("toast"))))}function pt(e,t){return ee.Z.fromSideEffect((e=>{if("trackingButtonClick"===e.kind)t.next({kind:"trackingButtonClick"});else(0,g.L0)(e.kind)}),e.pipe(q.oA))}function mt(e,t){return ee.Z.fromSideEffect((e=>{switch(e.kind){case"trackingButtonClickAway":case"viewReport":case"enable":case"start":case"pause":case"resume":case"enableForDomain":case"resetForDomain":t.next(e);break;default:(0,g.L0)(e)}}),e.pipe(q.oA))}function gt(e,t){return ee.Z.composeUnion({compact:pt(e,t),expanded:mt(e,t)},(()=>e.pipe(q.oA,l.U((({trackingButtonExpanded:e})=>({state:e?"expanded":"compact"}))))))}function _t(e,t){return ee.Z.composeUnion({None:()=>dt.of(null),Some:ee.Z.composeKnot({value:gt(e,t)})},(()=>e.pipe(q.cp((({trackingState:e})=>"optedOut"===e?dt.of(m.YP):dt.of(m.G(e)))))))}class ft{constructor(e,t,n,i,a){this.actions=t,this.errors=n,this._documentId=i,this._gnar=a,this._state=_.h.create(m.YP),this.state=this._state.view(),this._subs=new c.w,this._domain=e.view("page").view("domain").get(),this._subs.add(this._handleCSStateChange(e).subscribe()),this._subs.add(this._handleActions().subscribe()),this._subs.add(this._handleErrors().subscribe()),this._subs.add(this._handleEnabledForDomainOnce().subscribe()),this._subs.add(this._autocloseToast().subscribe())}_handleCSStateChange(e){return e.view("page").pipe(l.U((e=>{this._state.modify((t=>{var n;const i=null!==(n=e.humanWritingReport)&&void 0!==n?n:b.wg;return e.enabled&&("available"===i.kind||"enabled"===i.kind||"optedOut"===i.kind)?(0,o.zG)(t,m.UI((t=>this._reducePageStateToLocalState(e,t))),m.wp((()=>m.G(this._reducePageStateToLocalState(e))))):m.YP}))})))}_reducePageStateToLocalState({domain:e,humanWritingReport:t=b.wg},n){return{trackingState:"optedOut"===t.kind?"optedOut":"available"===t.kind?"available":(0,b.MP)(this._documentId,this._domain,t)?(0,b.Ng)(this._documentId,this._domain,t)?"tracking":"paused":"newDocument",optInPopupWasClosedOnce:"available"!==t.kind||t.optInPopUpWasClosedAtLeastOnce,optInPopupIsVisible:!!n&&n.optInPopupIsVisible,trackingButtonExpanded:!!n&&n.trackingButtonExpanded,enabledForDomain:(0,b.E3)(this._domain,t),domain:e,toast:n?n.toast:m.YP}}_handleEnabledForDomainOnce(){return this.actions.pipe(d.h((({kind:e})=>"enableForDomain"===e||"resetForDomain"===e)),h.w((({kind:e})=>"enableForDomain"===e?this._state.pipe(q.oA,d.h((({trackingButtonExpanded:e})=>!e))):Q.E)),u.q(1),p.b((()=>this._state.modify((e=>(0,o.zG)(e,m.tS((e=>m.G({...e,toast:m.G("domainTrackingStarted")})))))))))}_autocloseToast(){const e=this.actions.pipe(d.h((e=>"toastHover"===e.kind)),K.j("hovered"),D.O(!1));return this._state.pipe(q.oA,K.j("toast"),q.oA,h.w((()=>X.S3(e.pipe(h.w((e=>e?Q.E:J.timer(O.bd)))),this.actions.pipe(d.h((e=>"dismissToast"===e.kind)))))),p.b((()=>{this._state.modify((e=>(0,o.zG)(e,m.tS((e=>m.G({...e,toast:m.YP}))))))})))}_handleActions(){return this.actions.pipe(p.b((e=>{this._state.modify((t=>(0,o.zG)(t,m.tS((t=>{switch(e.kind){case"trackingButtonClick":return"available"===t.trackingState?t.optInPopupIsVisible?m.G({...t,optInPopupIsVisible:!1,optInPopupWasClosedOnce:!0}):(this._gnar.hwrOptInPopupShow(this._documentId),m.G({...t,optInPopupIsVisible:!0})):m.G({...t,trackingButtonExpanded:!0,toast:m.YP});case"trackingButtonClickAway":case"viewReport":return m.G({...t,trackingButtonExpanded:!1});case"pause":return m.G({...t,trackingState:"paused"});case"resume":case"start":return m.G({...t,trackingState:"tracking"});case"enable":return m.G({...t,trackingState:"tracking",trackingButtonExpanded:!1,optInPopupWasClosedOnce:!0,optInPopupIsVisible:!1,toast:m.G("documentTrackingStarted")});case"closeOptInPopup":return this._gnar.hwrOptInPopupClose(this._documentId),m.G({...t,optInPopupIsVisible:!1,optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1});case"optOut":return m.G({...t,trackingState:"optedOut",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,optInPopupIsVisible:!1,toast:m.G("optedOut")});case"enableForDomain":case"resetForDomain":case"toastHover":return m.G(t);case"optOutToastOkClick":case"dismissToast":return m.G({...t,toast:m.YP});case"optOutToastGoBackClick":return m.G({...t,trackingButtonExpanded:!1,optInPopupIsVisible:!0,toast:m.YP});default:(0,g.L0)(e)}})))))})))}_handleErrors(){return this.errors.pipe(p.b((e=>{this._state.modify((t=>(0,o.zG)(t,m.tS((t=>{if("reportGenerationFailed"===e.kind)return m.G({...t,toast:m.G("reportGenerationFailed")})})))))})))}view(){return W.createElement(te.w,null,ee.UI.mount(lt,(e=this,ee.Z.composeUnion({None:()=>dt.of(null),Some:ee.Z.composeKnot({value:ee.Z.composeKnot({optInPopup:(t=e.state,n=e.actions,ee.Z.composeUnion({None:()=>dt.of(null),Some:ee.Z.composeKnot({value:ee.Z.fromSideEffect((e=>{n.next({kind:e.kind})}),dt.of(null))})},(()=>t.pipe(q.oA,l.U((({optInPopupIsVisible:e})=>e?m.G(null):m.YP)))))),trackingButton:_t(e.state,e.actions),toast:ut(e.state,e.actions)})})},(()=>e.state)))));var e,t,n}dispose(){this._subs.unsubscribe()}}class bt{constructor(e){this._deps=e,this._subscriptions=new c.w,this._disposables=_.h.create([]),this._listener=_.h.create(m.YP),this._ui=_.h.create(m.YP),this.isActive=this._listener.view((e=>m.pC(e))),this._domain=e.CSState.view("page").view("domain").get(),this._subscriptions.add(this._handleStateChanges(e.CSState).subscribe()),this._subscriptions.add(this._handleUIActions(this._deps.uiActions).subscribe()),this._subscriptions.add(this._handleFeatureEvents(this._deps.events).subscribe()),this._subscriptions.add(this._logStartedTracking(this._deps.uiActions,this._deps.events).subscribe())}_handleStateChanges(e){return e.view("page").pipe(l.U((({enabled:e,humanWritingReport:t=b.wg})=>{if(e)switch(t.kind){case"available":case"optedOut":this._checkInitUI("optedOut"===t.kind),this._disposeListener();break;case"enabled":this._checkInitUI(!1),this._checkInitListener(),(0,b.Ng)(this._deps.documentId,this._domain,t)?(this._checkPermissions(),this._startTracking()):this._stopTracking();break;case"disabled":this._disposeListener(),this._disposeUI();break;default:(0,g.L0)(t)}else this._disposeUI(),this._disposeListener()})))}_handleUIActions(e){return e.pipe(l.U((e=>{switch(e.kind){case"trackingButtonClick":this._deps.gnar.hwrButtonClick(this._deps.documentId);break;case"closeOptInPopup":this._deps.csToBgActions.hwrSetEnabled(!0);break;case"start":case"enable":this._deps.gnar.hwrFeatureOptIn(this._deps.documentId),this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"resume":this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"enableForDomain":this._deps.gnar.hwrTrackingEnableForDomain(this._deps.documentId,this._domain),this._deps.csToBgActions.hwrStartTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"resetForDomain":this._deps.csToBgActions.hwrStopTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"pause":this._deps.gnar.hwrTrackingPause(this._deps.documentId),this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain});break;case"optOut":this._deps.gnar.hwrFeatureOptOut(this._deps.documentId),this._deps.csToBgActions.hwrOptOut();break;case"viewReport":this._deps.gnar.hwrReportButtonClick(this._deps.documentId),this._viewReport()}})))}_logStartedTracking(e,t){return e.pipe(d.h((({kind:e})=>"enable"===e||"start"===e||"resume"===e)),l.U((({kind:e})=>"resume"===e)),h.w((e=>t.pipe(d.h((({kind:e})=>"knownStateMismatch"===e||"knownStateMatch"===e)),l.U((t=>({event:t,isResume:e})))))),u.q(1),p.b((({event:e,isResume:t})=>{"knownStateMismatch"===e.kind?this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,e.lengthDifference):this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,0)})))}_handleFeatureEvents(e){return e.pipe(p.b((e=>{switch(e.kind){case"sourcedTextAdded":this._deps.gnar.hwrKnownSourcePaste(this._deps.documentId,e.sourceDomain,e.textLength,e.promptDetected);break;case"unknownSourceTextAdded":this._deps.gnar.hwrUnknownSourcePaste(this._deps.documentId,e.textLength);break;case"sourceAdded":this._deps.gnar.hwrKnownSourceDetect(e.sourceDomain,e.textLength,!1)}})))}_checkInitUI(e){this._ui.modify((t=>(0,o.zG)(t,m.wp((()=>{const t=new ft(this._deps.CSState,this._deps.uiActions,this._deps.errors,this._deps.documentId,this._deps.gnar),n=S.V.get({monitorAs:"human-writing-report"}).inject(y.EM.fromDocument(self.document,"grammarly-human-writing-report"),y.zs.appendChild(self.document.documentElement),w.G7.showWhenLoaded(t.view()));return!e&&this._deps.gnar.hwrButtonShow(this._deps.documentId),m.G({viewModel:t,dispose:()=>{n.dispose(),t.dispose()}})})))))}_startTracking(){(0,o.zG)(this._listener.get(),m.UI((e=>{e.startTracking()})))}_stopTracking(){(0,o.zG)(this._listener.get(),m.UI((e=>{e.stopTracking()})))}_checkInitListener(){this._listener.modify((e=>(0,o.zG)(e,m.wp((()=>m.G(new H(this._deps.documentId,this._deps.alertsState,this._deps.textObserver,this._deps.selectionSource,this._deps.CSState,this._deps.replacementListener,this._deps.events)))))))}async _checkPermissions(){if(!await(0,k.OB)().bgRpc.api.isPermissionGranted(f.d.clipboardRead)){this._deps.gnar.hwrClipboardPermissionRequest(this._deps.documentId);await(0,k.OB)().bgRpc.api.requestGrantPermission(f.d.clipboardRead)?this._deps.gnar.hwrClipboardPermissionAllow(this._deps.documentId):this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId)}}_viewReport(){(0,o.zG)(this._listener.get(),m.UI((e=>{try{e.getReportableDocument().then((e=>{fetch((0,v.l9)(this._deps.documentId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})})).catch((()=>{this._deps.errors.next({kind:"reportGenerationFailed"})}))}catch(e){this._deps.errors.next({kind:"reportGenerationFailed"})}e.getReportableDocument().then((e=>this._deps.backendClient.generateReport(this._deps.documentId,e).then((e=>{self.open(e,"_blank")})))).catch((()=>{this._deps.errors.next({kind:"reportGenerationFailed"})}))})))}_disposeUI(){this._ui.modify((e=>(0,o.zG)(e,m.tS((e=>(e.dispose(),m.YP))))))}_disposeListener(){this._listener.modify((e=>(0,o.zG)(e,m.tS((e=>(e.dispose(),m.YP))))))}dispose(){this._subscriptions.unsubscribe(),this._disposeUI(),this._disposeListener()}}},24814:(e,t,n)=>{if(n.r(t),n.d(t,{CopyContentListener:()=>U}),1388==n.j)var i=n(82823);if(1388==n.j)var a=n(8748);if(1388==n.j)var r=n(65882);if(1388==n.j)var s=n(64965);if(1388==n.j)var o=n(78488);if(1388==n.j)var c=n(65647);if(1388==n.j)var l=n(14765);if(1388==n.j)var d=n(60841);if(1388==n.j)var h=n(99793);if(1388==n.j)var u=n(55446);if(1388==n.j)var p=n(78084);if(1388==n.j)var m=n(22889);if(1388==n.j)var g=n(13195);if(1388==n.j)var _=n(97697);if(1388==n.j)var f=n(44424);if(1388==n.j)var b=n(20715);if(1388==n.j)var v=n(83780);if(1388==n.j)var k=n(64218);if(1388==n.j)var S=n(74857);if(1388==n.j)var y=n(27628);if(1388==n.j)var w=n(90049);if(1388==n.j)var C=n(70989);if(1388==n.j)var x=n(25770);if(1388==n.j)var I=n(8754);if(1388==n.j)var E=n(56195);if(1388==n.j)var T=n(42818);if(1388==n.j)var A=n(88241);if(1388==n.j)var D=n(85615);if(1388==n.j)var P=n(50439);if(1388==n.j)var G=n(16692);if(1388==n.j)var R=n(77256);if(1388==n.j)var L=n(56735);function B(e){return e.length>25?`${e.slice(0,25)}...`:e}class U{constructor(e,t,n){this._env=e,this._featureState=t,this._gnar=n,this._log=A.Y.create("CopyContentListener"),this._subs=new i.w,this._clipboardText=x.h.create(""),this._genAIMatcher=(0,L.O7)(),null!=e.browserApi&&E.XW.some((e=>-1!=location.hostname.search(e)))?(this._store=(0,R.T)((0,D.D)(e.browserApi.preferences)),this._trackingEnabled=r.aj(s.R(document,"visibilitychange").pipe(o.b((()=>{this._log.debug("visibilitychange",document.hidden?"hidden":"visible")})),c.U((()=>!document.hidden)),l.O(!document.hidden)),t).pipe(c.U((([e,t])=>e&&(0,T.sZ)(t))),d.w((e=>e?this._env.bgRpc.api.isPermissionGranted(I.d.clipboardRead):Promise.resolve(!1))),h.shareReplay({bufferSize:1,refCount:!0})),this._subs.add(this._trackingEnabled.subscribe((e=>{this._log.debug(`Tracking enabled: ${e}`)}))),this._subs.add(this._setupTrackingBecameEnabledHandler()),this._subs.add(this._clipboardText.pipe(u.h((e=>e.length>0))).subscribe((e=>this._onClipboardChange(e)))),this._log.debug("CopyContentListener initialized")):(this._trackingEnabled=a.E,this._log.debug("CopyContentListener is not supposed to be initialized here"))}_readClipboard(){return p.P((()=>navigator.clipboard.readText())).pipe(m.a((e=>e.pipe(g.b(((e,t)=>(0===t&&this._log.debug("Error getting text, will retry",e.message),_.s((()=>t>0),f._(e),b.of(e).pipe(v.g(50))))))))),k.K((e=>(this._log.debug("Error getting text, after one retry, give up for now",e.message),a.E))))}_setupTrackingBecameEnabledHandler(){return this._trackingEnabled.pipe(u.h(Boolean),S.b(0),d.w((()=>this._readClipboard().pipe(o.b((e=>{this._log.debug("Window focused and tracking enabled. Saving Clipboard text:",B(e)),this._clipboardText.set(e)}))))),y.c(this._userActionHandler())).subscribe()}_userActionHandler(){const e={capture:!0,once:!1,passive:!0};return w.T(s.R(self,"mouseup",e),s.R(self,"keyup",e),s.R(self,"copy",e)).pipe(S.b(300),C.M(this._trackingEnabled),u.h((([e,t])=>t)),d.w((()=>this._readClipboard())),o.b((e=>{this._log.debug("User action happened. Saving Clipboard text:",B(e)),this._clipboardText.set(e)})))}_onClipboardChange(e){const t=this._genAIMatcher.getPromptForText(e);t&&this._log.debug("Found genAI prompt for text:",t);this._store.get().then((n=>{const i=n.copiedTextMessage;if(null==i||!(null==i?void 0:i.valid)||(null==i?void 0:i.valid)&&i.copiedText!=e){const n=new G.m;this._log.debug("New clipboard text:",B(e)),this._gnar.hwrKnownSourceDetect(self.location.origin,e.length,Boolean(t)),this._store.set(P.v.make(n.url,n.title,e,t||void 0))}}))}dispose(){this._subs.unsubscribe(),this._genAIMatcher.dispose()}}},16692:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(){this.location=self.location,this._title=document.title}get url(){return this.location.href}get title(){return this._title}isGoogleDocs(){return"docs.google.com"==this.location.hostname}get documentID(){if("docs.google.com"==this.location.hostname){const e=this.location.pathname.match("/document/d/([^/]+)");return(null==e?void 0:e[1])||null}return null}}},56735:(e,t,n)=>{if(n.d(t,{O7:()=>u}),1388==n.j)var i=n(82823);if(1388==n.j)var a=n(36072);if(1388==n.j)var r=n(65647);if(1388==n.j)var s=n(55446);if(1388==n.j)var o=n(25770);if(1388==n.j)var c=n(62617);if(1388==n.j)var l=n(16711);class d{getPromptForText(){return null}dispose(){}}class h{constructor(e,t){this._promptsSelector=e,this._responsesSelector=t,this._pairs=new Map,this._subs=new i.w,this._prompts=new a.xQ,this._pairsOutdated=o.h.create(!0),this._subs.add(this._setupMutationObserver().subscribe((()=>{this._pairsOutdated.set(!0)})))}_searchForPairs(){const e=Array.from(document.querySelectorAll(this._promptsSelector));if(e){const t=Array.from(document.querySelectorAll(this._responsesSelector));t&&t.length===e.length&&e.forEach(((e,n)=>{var i,a;const r=(null===(i=e.textContent)||void 0===i?void 0:i.trim())||null;if(r){const e=(null===(a=t[n].textContent)||void 0===a?void 0:a.trim())||null;e&&this._pairs.set((0,c.Ue)(e),{prompt:r,response:e})}}))}this._pairsOutdated.set(!1)}_setupMutationObserver(){return l.x.create(document,{attributes:!1,subtree:!0,childList:!0}).pipe((0,r.U)((e=>e.filter((e=>e.addedNodes.length>0)).some((e=>Array.from(e.addedNodes).filter((e=>e instanceof HTMLElement)).some((e=>e.matches(this._responsesSelector)||e.querySelector(this._responsesSelector))))))),(0,s.h)(Boolean))}getPromptForText(e){var t;return this._pairsOutdated.get()&&this._searchForPairs(),(null===(t=this._pairs.get((0,c.Ue)(e)))||void 0===t?void 0:t.prompt)||null}dispose(){this._subs.unsubscribe()}}function u(){const e=self.location.hostname;return"chat.openai.com"===e||"chatgpt.com"===e?new h('div[data-message-author-role="user"]','div[data-message-author-role="assistant"]'):"gemini.google.com"===e?new h("div.query-content","div.response-content"):new d}},62617:(e,t,n)=>{n.d(t,{CZ:()=>h,Hq:()=>r,QY:()=>i,Ue:()=>u,aS:()=>d,l9:()=>l});var i,a,r,s=n(43534),o=n(21768),c=n(56195);function l(e){return`${c.yx}qa/document/${encodeURIComponent(e)}`}function d(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),i=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-i,e.length)}`}function h(e){const t=e.match(/`{3,}[^`]*`{3,}/g);return null==t?e:t.reduce(((e,t)=>e.replace(t,"")),e)}function u(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>s.s.isInsertString(t)?e+s.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>s.s.isDelete(e)));let n=0;return t.forEach((e=>{s.s.isDelete(e)&&(n+=e.delete)})),n},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(s.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:s.s.isDelete(n)?t.originalTextPointer+=n.delete:s.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new o.i([]);let n=0;const i=Math.min(e.length,t.length);for(;n<i&&e[n]===t[n];)n++;let a=0;for(;n+a<i&&t[t.length-a-1]===e[e.length-a-1];)a++;const r=e.length-(n+a),s=t.length-(n+a),c=[...n>0?[{retain:n}]:[],{delete:r},{insert:t.substring(n,n+s)}];return new o.i(c)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>s.s.isInsertString(e)?!e.insert.length:!s.s.isDelete(e)||!e.delete))}}(i||(i={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(a||(a={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=d(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),i=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===i[t].text&&e.sourceName===i[t].sourceName))}}(r||(r={}))},85615:(e,t,n)=>{n.d(t,{D:()=>i});const i=e=>({getAll:async()=>await e.getAll(),get:async t=>await e.get(t),view:()=>{throw new Error("not_implemented")},patch:async t=>await e.set(t),changes:e.changes})},50439:(e,t,n)=>{var i;n.d(t,{v:()=>i}),function(e){e.make=function(e,t,n,i){return{valid:!0,copiedText:n,sourceURL:e,sourceName:t,userPrompt:i}}}(i||(i={}))}}]);