(self.webpackChunk=self.webpackChunk||[]).push([[274],{23940:(e,t,i)=>{var r=i(43527),n="chrome-extension://__MSG_@@extension_id__/",a="moz-extension://__MSG_@@extension_id__/",s="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||n,l=self.GR_RESOURCE_ROOT||a,d=self.GR_RESOURCE_ROOT||s;e.exports={__css:r.toString().replace(new RegExp(n,"g"),o).replace(new RegExp(a,"g"),l).replace(new RegExp(s,"g"),d),...r.locals}},79430:(e,t,i)=>{i.r(t),i.d(t,{G2FeatureImpl:()=>kt});var r=i(18117),n=i(90023),a=i(49231),s=i(82823),o=i(63469),l=i(60841),d=i(55446),c=i(73863),h=i(60165),g=i(31584),m=i(58303),u=i(67325),p=i(25770),f=i(73930),w=i(22639),v=i(87175),S=i(88241),b=i(65882),_=i(14765),y=i(65647),C=i(64965),k=i(74857),x=i(34859),R=i(4582),E=i(72521),I=i(55901),F=i(24202),B=i(43818),T=i(89159),P=i(65271);const M=e=>({zIndex:e,position:"absolute",top:0,left:0,width:"100%",pointerEvents:"all"}),G=({children:e})=>a.createElement(T.L,{chunkName:"g2"},a.createElement(B.F.div,{style:M(99)},e)),A=({children:e})=>a.createElement(T.L,{chunkName:"g2"},a.createElement(B.F.div,{style:M(P.op)},e));function L(e){return{kind:"sessionText",rev:Number.MIN_SAFE_INTEGER,range:e}}var D=i(99793),O=i(75155),N=i(16470);function z(e,t){return e.pipe(_.O(null),y.U((()=>(0,n.zG)(t.getCurrentSelection(!0),N.Ls,m.ij,m.hX((0,n.ff)(O.SV.isCollapsed))))),D.skipBy(m.Eh(O.SV.eq)))}const H={[F.u.gmailCompose]:15,[F.u.gmailReply]:16,[F.u.gmailComposeStandalone]:15,[F.u.gmailComposeFullScreen]:15,[F.u.slackMessage]:2,[F.u.slackGenericQuill]:2,[F.u.slackThread]:2,[F.u.gDocsCanvas]:0,[F.u.gDocsComments]:0};const q={[F.u.gmailReply]:{top:170,bottom:140}};class V{constructor(e){var t;this._params=e,this._subs=new s.w,this._logger=S.Y.create("G2IntegrationGeneric"),this._textFieldVisibleRect=p.h.create({top:0,left:0,width:0,height:0}),this._selectionRange=p.h.create(m.YP),this.name="g2-generic-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightGeometryFilter=R.qH.everything,this.highlightGeometryInvalidator=(0,R.WF)(this._params.textFieldLayout),this.selectionRange=this._selectionRange.view(),this.sidelinePositioningStrategy={kind:"alignWithTextFieldLeftBoundary"},this.isEnabled=p.h.create(!0),this.paragraphFilter=n.W8,this.uiContainer=A,this._viewPortOffsets=void 0!==this._params.getVerticalViewportOffsets?this._params.getVerticalViewportOffsets(this._params.integrationInfo.integrationName):(t=this._params.integrationInfo.integrationName,m.ij(q[t])),this._subs.add(b.aj([this._params.textFieldLayout.visibleRect.changes.pipe(_.O(this._params.textFieldLayout.visibleRect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(_.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(y.U((([e])=>{const t={top:e.client.top,left:e.client.left,width:e.size.width,height:e.size.height},i=this._getLeftOffset(),{top:r,bottom:a}=(0,n.zG)(this._viewPortOffsets,m.fS((()=>({top:0,bottom:0}))));return this._getVisibleTextFieldRect(t,r,a,i)}))).subscribe((e=>{this._textFieldVisibleRect.set(e)}))),this._subs.add(z(C.R(this._params.textFieldElement.ownerDocument,"selectionchange").pipe(k.b(100),x.h(void 0)),this._params.selectionService).subscribe(g.wW(this._selectionRange)))}_getVisibleTextFieldRect(e,t,i,r){if(this._params.integrationInfo.integrationName===F.u.gmailReply){const n=(0,I.Jj)(this._params.textFieldElement).document.documentElement.getBoundingClientRect(),a=E.UL.getIntersection(e,n);if(a||(this._params.telemetry.warn({message:"Failed to find intersection between the text field's visible layout rect and window rect. The resulting text field's visible rect may not be appropriate."}),this._logger.warn("Failed to find intersection between the text field's visible layout rect and window rect. The resulting text field's visible rect may not be appropriate.",{integrationName:this._params.integrationInfo.integrationName})),null===a)return{top:0,height:0,left:0,width:0};const s=a.top<t?t:a.top;return{top:s,height:a.height+a.top>n.height-i?n.height-i-s:a.height,left:a.left-r,width:a.width+r}}return{top:e.top+t,height:e.height-i,left:e.left-r,width:e.width+r}}_getLeftOffset(){return this._params.integrationInfo.integrationName in H?function(e){return H[e]}(this._params.integrationInfo.integrationName):(this._logger.debug(`No left offset defined for integration with name "${this._params.integrationInfo.integrationName}," defaulting to zero.`),0)}getRewriteScope(e){return L(e.textRange)}dispose(){this._subs.unsubscribe()}}var U=i(61179),W=i(32082),j=i(99213),Y=i(18597),$=i(81772),J=i(5233),K=i(91450),Q=i(73674),X=i(41860);const Z=({paragraph:e,fullText:t})=>{let i=e.textRange.start,r=!1;for(;i>=0&&!r;){if(t.charAt(i)===X.Mx)return!1;t.charAt(i)===X.$O?r=!0:i--}i=e.textRange.end;let n=!1;for(;i<=t.length&&!n;){if(t.charAt(i)===X.$O)return!1;t.charAt(i)===X.Mx?n=!0:i++}return r&&n};class ee{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("G2IntegrationGoogleDocs"),this._textFieldVisibleRect=p.h.create({top:0,left:0,width:0,height:0}),this._highlightCollectionFilterSource=new J.b(this._params.textObserver),this._selectionRange=p.h.create(m.YP),this.name="g2-google-docs-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightGeometryFilter=this._highlightCollectionFilterSource.highlightsFilterFactory(),this.highlightGeometryInvalidator=this._textFieldVisibleRect.pipe(W.D((()=>this._params.textObserver.textMapChanged))),this.selectionRange=this._selectionRange.view(),this.sidelinePositioningStrategy=(0,$.vc)(this._params.textFieldElement)?{kind:"alignWithTextFieldLeftBoundary"}:{kind:"hardcodedLeftOffset",leftOffset:40},this.isEnabled=this._params.integrationInfo.integrationMode.view((e=>e===Y.yj.write)),this.paragraphFilter=(0,U.ff)(Z),this.uiContainer=G,this._subs.add(b.aj([this._params.textFieldLayout.rect.changes.pipe(_.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(_.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(y.U((()=>{var e;const t=this._params.textFieldElement.getBoundingClientRect(),i={top:t.top,left:t.left,width:t.width,height:t.height},r=(0,j.Gg)(this._params.textFieldElement)||(0,j.g)(this._params.textFieldElement)||(0,I.Jj)(this._params.textFieldElement).document.documentElement,n=(0,$.iy)(this._params.textFieldElement);if(null!==n){const{left:t,width:a}=null!==(e=E.UL.getIntersection(i,n.getBoundingClientRect()))&&void 0!==e?e:i,s=E.UL.getIntersection({...i,left:t,width:a},r.getBoundingClientRect());return null!==s?s:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),{...i,left:t,width:a})}{this._logger.warn("Failed to retrieve rendering canvas. The resulting text field's visible rect lateral boundaries may not be appropriate.");const e=E.UL.getIntersection(i,r.getBoundingClientRect());return null!==e?e:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),i)}}))).subscribe(g.wW(this._textFieldVisibleRect))),this._subs.add(z(this._params.selectionSource.data.behavior.pipe(x.h(void 0)),this._params.selectionService).subscribe(g.wW(this._selectionRange)))}getRewriteScope(e){if(e.text.includes(Q.o2)){const t=this._params.textObserver.getCurrentTextMap().getPlainText(),i=t.slice(e.textRange.start,e.textRange.end);let r=i;for(let t=0;t<i.length;t++)if(i.charAt(t)===Q.o2){const i=this._params.textObserver.getCurrentTextMap().getFragmentAtOffset(e.textRange.start+t),n=i instanceof K.I?i.getParsedFragment().fragment.text:Q.o2;r=r.replace(Q.o2,n)}return i!==r?(this._logger.debug('Found "smart chips" and converted them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetry.infoOncePerMessage({message:"Converted Google Docs smart chips into plain text."})):(this._logger.warn('Found "smart chips" but could not convert them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetry.warn({message:"Could not convert Google Docs smart chips into plain text."})),{kind:"otherText",text:t.slice(0,e.textRange.start)+r+t.slice(e.textRange.start+r.length),range:{start:e.textRange.start,end:e.textRange.start+r.length}}}return L(e.textRange)}dispose(){this._subs.unsubscribe()}}var te=i(39408),ie=i(42530);const re="Calliope/Rewrite/QualityPush/ImproveItPush";class ne{constructor(e){this._params=e,this._subs=new s.w,this._inlineAlertsFilter=p.h.create(n.W8),this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this.alerts=this._params.alertProcessor.alerts.state.view((e=>Object.values(e).filter(ie.Nf).filter(te.S.isTransformJsonCapiAlert))),this.calliopeAlerts=this.alerts.view((e=>e.filter((e=>e.patternName===re)))),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(y.U((e=>t=>{return e(t)&&(i=t,!this._params.featureFlags.signalingSidelines||!(te.S.isCapiAlert(i)&&i.patternName===re));var i}))).subscribe(g.wW(this._inlineAlertsFilter)))}getCalliopeAlertsWithinTextRange(e){return function(e,t){return e.filter((e=>e.transformJSON.highlights.some((e=>e.s>=t.start&&e.e<=t.end))))}(this.calliopeAlerts.get(),e)}dispose(){this._subs.unsubscribe()}}function ae(e){let t=0,i=0;const r=[];for(;i<=e.length;)"\n"!==e.charAt(i)&&""!==e.charAt(i)||(t!==i&&r.push({start:t,end:i}),t=i+1),i++;return r}class se{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("ParagraphCollectionServiceImpl"),this._paragraphs=p.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(d.h((e=>!e.deltaChange.isEmpty)),k.b(1e3),_.O(null),y.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:ae(e),fullText:e}})),y.U((({paragraphTextRanges:e,fullText:t})=>{const i=e.map(((e,i)=>function(e,t,i){return{id:`g2-paragraph-${t.start}-${t.end}`,sequentialId:e,textRange:t,text:i.slice(t.start,t.end)}}(i,e,t)));return i.filter((e=>this._params.integration.paragraphFilter({paragraph:e,fullText:t})))}))).subscribe(g.wW(this._paragraphs))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const t of e)this._paragraphById.set(t.id,t)}))),this._subs.add(this._paragraphs.subscribe((e=>this._logger.debug("Paragraphs updated.",e))))}getParagraphById(e){return m.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var oe=i(72848),le=i(49101),de=i(21768),ce=i(47338),he=i(78008),ge=i(47344),me=i(63843),ue=i(12518),pe=i(84161),fe=i(57536),we=i(6824),ve=i(36661),Se=i(80611);const be=ve.n(Se.l7(we.Schemable)({sensitiveString:we.string}))(Se.a9).is;var _e=i(59558);const ye=Se.Sy((e=>e.struct({kind:e.literal(_e.PU.Final)}))),Ce=Se.Sy((e=>e.intersect(ye(e))(Se.WV(e)))),ke=ve.n(Se.l7(we.Schemable)({sensitiveString:we.string}))(Ce).is;var xe=i(46393);function Re(e){const t=(e=>{switch(e.kind){case"improve":return{kind:"default"};case"rephrase":return{kind:"rephrase"};case"shorten":return{kind:"other",actionId:{id:"VBarG2Shorter"}};case"friendly":return{kind:"other",actionId:{id:"VBarG2Friendly"}};case"formal":return{kind:"other",actionId:{id:"VBarG2Formal"}};case"customPrompt":return{kind:"userPrompt",prompt:e.prompt};default:(0,me.L0)(e)}})(e.type);return{correlationId:e.id,kind:{...t},entrypoint:{family:"g2",name:_e.K0.VbarCard},args:{},metadata:{}}}class Ee{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("RewriteServiceImpl"),this._relevantCapiMessages=this._params.checkingService.pipe(o.oA,l.w((e=>e.capiMessages)),d.h((0,ge.Kg)(ke,be))),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e))))}_handleServerMessage(e){be(e)?(this._params.telemetry.warn({message:'Server message with result "failure" received.'}),this._handleErrorMessage(e)):ke(e)?(this._params.telemetry.infoOncePerMessage({message:'Server message with result "success" received.'}),this._handleRewriteResultMessage(e)):(0,me.vE)(e)}_handleRewriteResultMessage(e){var t;const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._params.telemetry.warn({message:'Server message with result "success" and unknown correlation ID received.'}),this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e});else{const r={kind:"ready",id:i.get().id,type:i.get().type,text:i.get().text,augmentedText:i.get().augmentedText,textRange:i.get().textRange,title:e.explanation,rewriteText:e.rewrite,rewriteDiff:(0,n.zG)(xe.F.getDiff(null!==(t=m.WG(i.get().augmentedText))&&void 0!==t?t:i.get().text,e.rewrite),ue.mapLeft((t=>this._logger.error("Failed to get diff for rewrite.",{error:t,newText:e.rewrite}))),m.Uo),source:"server"};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:r}),i.set(r)}}_handleErrorMessage(e){const t=this._cachedRewriteMap.get(e.correlationId);if(void 0===t)this._params.telemetry.warn({message:'Server message with result "failure" and unknown correlation ID received.'}),this._logger.warn("Received a failed result with unknown correlation ID.",{errorMessage:e});else{const i={kind:"error",id:t.get().id,type:t.get().type,text:t.get().text,augmentedText:t.get().augmentedText,textRange:t.get().textRange,errorType:e.errorType,errorDetails:e.details};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:t.get(),rewriteAfter:i}),t.set(i)}}async getRewrite(e,t,i,r=!0){const n=(0,fe.Wu)(t),a=`${e.kind}-${i.start}-${i.end}-${n}`,s=this._cachedRewriteIdMap.get(a),o=void 0!==s?this._cachedRewriteMap.get(s):void 0,l="customPrompt"!==e.kind&&r&&void 0!==o&&"error"!==o.get().kind;if(l)return o.modify((e=>"ready"===e.kind?{...e,source:"cache"}:e)),o;l||void 0===s||this._cachedRewriteMap.delete(s);const d=(0,oe.Z)();this._cachedRewriteIdMap.set(a,d);const h=p.h.create({kind:"loading",id:d,type:e,text:t,augmentedText:m.YP,textRange:i});this._cachedRewriteMap.set(h.get().id,h);const g=this._params.checkingService.get();if(m.Wi(g))return this._params.telemetry.error({message:"Getting rewrite failed: Checking service not initialized."}),this._logger.error("Failed to get rewrite. Checking service not initialized yet."),h.modify((e=>({...e,kind:"error",errorType:{kind:"other",type:"checking_service_not_initialized"}}))),h;try{this._params.textChangeBuffer.flush(),await g.value.checkingStatus.pipe(k.b(300),ce.n((e=>e===f.Hq.inProgress)),c.q(1),he.V(1e4)).toPromise()}catch(e){const t="Getting rewrite failed: Checking service status stuck in-progress.";return this._params.telemetry.error({message:t,error:e}),this._logger.error(t,{error:e}),h.modify((e=>({...e,kind:"error",errorType:{kind:"other",type:"checking_service_status_stuck_in_progress"}}))),h}const u=Re(h.get()),w=this._params.integration.getRewriteScope(h.get());"otherText"===w.kind&&h.modify((e=>{var t,i;return{...e,augmentedText:m.G(w.text.slice(null===(t=w.range)||void 0===t?void 0:t.start,null===(i=w.range)||void 0===i?void 0:i.end))}}));try{const e=await g.value.sendMessage("text_actions:invokeRewrite",u,!1,{kind:"scope",scope:w})();if(ue.isLeft(e))throw e.left.message;return h}catch(e){const t='Getting rewrite failed: Sending "text_actions:invokeRewrite" message to CAPI failed.';return this._params.telemetry.error({message:t,error:e}),this._logger.error(t,{error:e}),h.modify((e=>({...e,kind:"error",errorType:{kind:"other",type:"checking_service_send_message_failed"}}))),h}}getImproveRewriteFromCalliopeAlert(e,t,i){var r;const a=(0,oe.Z)(),s=(0,n.zG)(e.transformJSON.alternatives,m.UI((e=>e.context[0])),m.WG),o=(0,n.zG)(e.transformJSON.alternatives,m.UI((e=>e.alternatives[0])),m.WG);if(null===s||s.s<i.start||s.e>i.end||null===o){const e='Failed to retrieve "improve" rewrite from Calliope alert.';return this._logger.error(e),this._params.telemetry.error({message:e}),{kind:"error",id:a,type:{kind:"improve"},text:t,augmentedText:m.YP,textRange:i,errorType:{kind:"other",type:"get_rewrite_from_calliope_alert_failed"}}}const l=o.ops.filter((e=>!le.JU.isOptionalContextRetain(e))),d=[{retain:s.s-i.start},...l],c=new de.i(d),h=(0,pe.l)(c,t);return{kind:"ready",id:a,type:{kind:"improve"},text:t,augmentedText:m.YP,textRange:i,title:null!==(r=e.extraProperties.vbar_card_title)&&void 0!==r?r:"Use our best version",rewriteText:h,rewriteDiff:(0,n.zG)(xe.F.getDiff(t,h),ue.mapLeft((e=>this._logger.error("Failed to get diff for rewrite.",{error:e,newText:h}))),m.Uo),source:"alert"}}dispose(){this._subs.unsubscribe()}}class Ie{constructor(e){this._params=e}_sendCapiFeedback(e,t){(0,n.zG)(this._params.checkingService.get(),m.g_((()=>this._params.telemetryService.error({message:"Failed to send CAPI feedback; checking service not initialized.",data:{vBarId:e,vBarCardRewriteUserInteraction:t}})),(i=>i.sendG2UIFeedback(e,t))))}vBarCardRewriteReadyShown(e){this._sendCapiFeedback(e)}vBarCardRewriteApplied(e){this._sendCapiFeedback(e,"insert")}vBarCardRewriteCopied(e){this._sendCapiFeedback(e,"copy")}vBarCardRewriteRegenerated(e){this._sendCapiFeedback(e,"regenerate")}}class Fe{constructor(e){this._params=e}_sendTelemetryError(e,t){this._params.telemetryService.error({message:"Failed to track Gnar event.",error:t,data:{eventName:e}})}_sendNoSessionUuidTelemetryError(e){this._sendTelemetryError(e,"Failed to retrieve sessionUuid.")}_trackWithSessionUuid(e,t){return(0,n.zG)(this._params.checkingService.get(),m.tS((e=>m.ij(e.sessionUuid))),m.g_((()=>this._sendNoSessionUuidTelemetryError(e)),(i=>t(i).catch((t=>this._sendTelemetryError(e,t))))))}_isGoogleDocs(){return"googleDocs"===this._params.integrationInfo.kind}_getRewriteReadyShownStatus(e){switch(e.source){case"server":return"loaded";case"cache":return"cached";case"alert":return"prepopulated";default:(0,me.L0)(e.source)}}_getRewriteErrorShownStatus(e){return`failed_${e.errorType.kind}`}vBarShown(e){this._trackWithSessionUuid("vBarShow",(t=>this._params.gnarClient.vBarShow(this._isGoogleDocs(),t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarHidden(e){this._trackWithSessionUuid("vBarHide",(t=>this._params.gnarClient.vBarHide(this._isGoogleDocs(),t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardShown(e){this._trackWithSessionUuid("vBarCardShow",(t=>this._params.gnarClient.vBarCardShow(this._isGoogleDocs(),t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardClosed(e){this._trackWithSessionUuid("vBarCardClose",(t=>this._params.gnarClient.vBarCardClose(this._isGoogleDocs(),t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardRewriteEmptyShown(e){this._trackWithSessionUuid("vBarCardRewriteLoad",(t=>this._params.gnarClient.vBarCardRewriteLoad(this._isGoogleDocs(),e.rewrite.type.kind,t,"empty",e.vBar.text.length,e.vBar.id,e.vBar.kind,e.durationMs)))}vBarCardRewriteReadyShown(e){this._trackWithSessionUuid("vBarCardRewriteLoad",(t=>this._params.gnarClient.vBarCardRewriteLoad(this._isGoogleDocs(),e.rewrite.type.kind,t,this._getRewriteReadyShownStatus(e.rewrite),e.vBar.text.length,e.vBar.id,e.vBar.kind,e.durationMs)))}vBarCardRewriteErrorShown(e){this._trackWithSessionUuid("vBarCardRewriteLoad",(t=>this._params.gnarClient.vBarCardRewriteLoad(this._isGoogleDocs(),e.rewrite.type.kind,t,this._getRewriteErrorShownStatus(e.rewrite),e.vBar.text.length,e.vBar.id,e.vBar.kind,e.durationMs)))}vBarCardRewriteApplied(e){this._trackWithSessionUuid("vBarCardRewriteApply",(t=>this._params.gnarClient.vBarCardRewriteApply(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardRewriteCopied(e){this._trackWithSessionUuid("vBarCardRewriteCopy",(t=>this._params.gnarClient.vBarCardRewriteCopy(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardRewriteRegenerated(e){this._trackWithSessionUuid("vBarCardRewriteRegenerate",(t=>this._params.gnarClient.vBarCardRewriteRegenerate(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.text.length,e.vBar.id,e.vBar.kind)))}vBarCardRewriteFeedbackSubmitted(e){const t=JSON.stringify({vBarId:e.vBar.id,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,message:e.message,domain:this._params.integrationInfo.domain});this._params.gnarClient.feedbackSentButtonClick(t,"g2",e.score).catch((e=>this._sendTelemetryError("feedbackSentButtonClick",e)))}}class Be{constructor(e){this._params=e,this._gnarTrackingService=new Fe({gnarClient:this._params.gnarClient,checkingService:this._params.checkingService,integrationInfo:this._params.integrationInfo,telemetryService:this._params.telemetryService}),this._capiFeedbacksTrackingService=new Ie({checkingService:this._params.checkingService,telemetryService:this._params.telemetryService})}vBarShown(e){this._gnarTrackingService.vBarShown(e)}vBarHidden(e){this._gnarTrackingService.vBarHidden(e)}vBarCardShown(e){this._gnarTrackingService.vBarCardShown(e)}vBarCardClosed(e){this._gnarTrackingService.vBarCardClosed(e)}vBarCardRewriteEmptyShown(e){this._gnarTrackingService.vBarCardRewriteEmptyShown(e)}vBarCardRewriteReadyShown(e){this._gnarTrackingService.vBarCardRewriteReadyShown(e),this._capiFeedbacksTrackingService.vBarCardRewriteReadyShown(e.vBar.id)}vBarCardRewriteErrorShown(e){this._gnarTrackingService.vBarCardRewriteErrorShown(e)}vBarCardRewriteApplied(e){this._gnarTrackingService.vBarCardRewriteApplied(e),this._capiFeedbacksTrackingService.vBarCardRewriteApplied(e.vBar.id)}vBarCardRewriteCopied(e){this._gnarTrackingService.vBarCardRewriteCopied(e),this._capiFeedbacksTrackingService.vBarCardRewriteCopied(e.vBar.id)}vBarCardRewriteRegenerated(e){this._gnarTrackingService.vBarCardRewriteRegenerated(e),this._capiFeedbacksTrackingService.vBarCardRewriteRegenerated(e.vBar.id)}vBarCardRewriteFeedbackSubmitted(e){this._gnarTrackingService.vBarCardRewriteFeedbackSubmitted(e)}}const Te=a.lazy((()=>Promise.all([i.e(3845),i.e(8170),i.e(8803),i.e(274)]).then(i.bind(i,4762)).then((({SidelineCardWrapper:e})=>({default:e}))))),Pe=a.lazy((()=>Promise.all([i.e(3845),i.e(8170),i.e(8803),i.e(274)]).then(i.bind(i,81682)).then((({SidelineCollection:e})=>({default:e})))));var Me=i(78488),Ge=i(90049),Ae=i(41092);const Le=({viewportRect:{top:e}})=>e,De=({viewportRect:{top:e,height:t}})=>e+t,Oe=e=>{if(e.length<2)return e;const t=e.sort(((e,t)=>Le(e)-Le(t))),i=[];let r=0,n=1,a=0;for(;r<e.length;){const e=t[r],s=t[n];void 0===s||Le(s)>=De(e)?(0===a&&i.push(e),r=n,a=0):(De(s)<=De(e)||(r=n),a++),n++}return i};var Ne=i(19775),ze=i(16460),He=i(91486),qe=i(50664);function Ve(e){return{highlightId:R.y$.Id.create(`g2-paragraph-highlight-${e.textRange.start}-${e.textRange.end}`),paragraphId:e.id,paragraphSequentialId:e.sequentialId,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null}}var Ue=i(59833),We=i(86185);class je{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("ParagraphHighlightCollectionViewModelImpl"),this._paragraphHighlights=p.h.create([]),this._emphasizedParagraphHighlight=p.h.create(m.YP),this.paragraphHighlights=this._paragraphHighlights.view(),this.emphasizedParagraphHighlight=this._emphasizedParagraphHighlight.view(),this._subs.add(this._params.paragraphCollectionService.paragraphs.subscribe((e=>{this._params.paragraphHighlightCollectionGeometry.removeAllHighlights();for(const t of e){const e=Ve(t);this._params.paragraphHighlightCollectionGeometry.addHighlight(e.highlightId,t.textRange,e)}}))),this._subs.add(b.aj([this._params.integration.textFieldVisibleRect,this._params.textFieldLayout.rect.changes.pipe(_.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(_.O(this._params.textFieldLayout.scroll.getCurrent())),this._params.paragraphHighlightCollectionGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(y.U((([e,t,i,r])=>{const a=r.reduce(((r,a)=>(0,n.zG)(function(e,t,i,r,a,s,o,l){return(0,n.zG)(m.ij((0,He.jr)(r)),m.UI((r=>{const n=(0,qe.Z)({kind:"offsetPoint",...r},a,s),d="alignWithTextFieldLeftBoundary"===l.kind?n.left-o.left:l.leftOffset,c=o.left+o.width-n.right,h={top:n.top,left:n.left-d,width:n.width+d+c,height:n.height};return{id:e,paragraphId:t,sequentialId:i,textFieldRect:{top:r.top,left:r.left-d,width:r.width+d+c,height:r.height},viewportRect:h,isScrolledIntoView:E.UL.doesRectContain(o,h)}})))}(a.meta.highlightId.toString(),a.meta.paragraphId,a.meta.paragraphSequentialId,a.rects,t.client,i,e,this._params.integration.sidelinePositioningStrategy),m.g_((()=>(this._params.telemetry.warn({message:"Creating highlight for paragraph failed."}),this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",a),r)),(e=>{const t=Math.min(e.viewportRect.left,r.minimumViewportRectLeft),i=Math.min(e.textFieldRect.left,r.minimumViewportRectLeft);return{paragraphHighlights:r.paragraphHighlights.concat(e),minimumViewportRectLeft:t,minimumTextFieldRectLeft:i}})))),{paragraphHighlights:[],minimumViewportRectLeft:Number.MAX_SAFE_INTEGER,minimumTextFieldRectLeft:Number.MAX_SAFE_INTEGER});return a.paragraphHighlights.map((e=>({...e,viewportRect:{...e.viewportRect,left:a.minimumViewportRectLeft,width:e.viewportRect.width+(e.viewportRect.left-a.minimumViewportRectLeft)},textFieldRect:{...e.textFieldRect,left:a.minimumTextFieldRectLeft,width:e.textFieldRect.width+(e.textFieldRect.left-a.minimumTextFieldRectLeft)}})))})),y.U(Oe),Me.b((e=>this._logger.debug("Paragraph highlights updated.",e)))).subscribe(g.wW(this._paragraphHighlights))),this._subs.add(Ge.T(this._params.textFieldLayout.scroll.changes.pipe(x.h(m.YP)),this._params.mouseData.pipe(Ae.U(Ne.S.hz30),D.skipBy(ze.Z.eq),y.U((({client:e,offset:t})=>{return i=this._paragraphHighlights.get(),r=e,a=t,s=this._params.textFieldElement,null!==r&&null!==a&&(0,We._N)(r,s)?(0,n.zG)(i,Ue.Ew((e=>E.UL.contains(a,e.textFieldRect)))):m.YP;var i,r,a,s})))).subscribe(g.wW(this._emphasizedParagraphHighlight)))}dispose(){this._subs.unsubscribe()}}class Ye{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("SelectionHighlightViewModelImpl"),this._selectionHighlight=p.h.create(m.YP),this.selectionHighlight=this._selectionHighlight.view(),this._subs.add(this._params.integration.selectionRange.subscribe((e=>{this._logger.debug("Selection range changed, updating selection highlight geometry accordingly.",e),this._params.selectionHighlightGeometry.removeAllHighlights(),(0,n.zG)(e,u.bw((e=>{const t=R.y$.Id.create(`g2-selection-highlight-${e.start}-${e.end}`);this._params.selectionHighlightGeometry.addHighlight(t,e,{highlightId:t,text:this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.start,e.end),textRange:e,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})})))}))),this._subs.add(b.aj([this._params.integration.textFieldVisibleRect,this._params.textFieldLayout.rect.changes.pipe(_.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(_.O(this._params.textFieldLayout.scroll.getCurrent())),this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(y.U((([e,t,i,r])=>(0,n.zG)(m.ij(r[0]),m.tS((r=>function(e,t,i,r,a){return(0,n.zG)(e,m.DT((e=>e.meta.text.trim().split(/\s+/).filter((e=>""!==e)).length>1)),m.tS((e=>(0,n.zG)((0,He.jr)(e.rects),m.ij,m.UI((n=>{const s=(0,qe.Z)({kind:"offsetPoint",...n},t,i),o="alignWithTextFieldLeftBoundary"===a.kind?s.left-r.left:a.leftOffset,l=r.left+r.width-s.right,d={top:s.top,left:s.left-o,width:s.width+o+l,height:s.height};return{id:e.meta.highlightId.toString(),text:e.meta.text,textRange:e.meta.textRange,viewportRect:d,isScrolledIntoView:E.UL.doesRectContain(r,d)}}))))))}(r,t.client,i,e,this._params.integration.sidelinePositioningStrategy))),m.UI((e=>{const t=this._params.paragraphHighlightCollectionViewModel.paragraphHighlights.get()[0];return t?{...e,viewportRect:{...e.viewportRect,left:t.viewportRect.left,width:t.viewportRect.width}}:e})))))).subscribe(g.wW(this._selectionHighlight))),this._subs.add(this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values()))).subscribe((e=>this._logger.debug("Selection highlight geometry udpated. Resulting highlights:",e)))),this._subs.add(this._selectionHighlight.subscribe((e=>this._logger.debug("Selection highlight udpated.",e))))}dispose(){this._subs.unsubscribe()}}var $e=i(9115),Je=i(33994),Ke=i(36072),Qe=i(40478),Xe=i(26230),Ze=i(45661),et=i(92616),tt=i(90522),it=i(27943),rt=i(125),nt=i(89980);const at={priority:rt.P.Priority.low,timeout:rt.P.DefaultTimeout,position:rt.P.Position.bottomLeft,viewType:rt.P.ViewType.standard};var st;!function(e){e.createFactory=function(){return{feedbackSubmitted:nt.r.createBuilder().build(at)}}}(st||(st={}));var ot=i(32066),lt=i(44860);const dt=({submitFeedback:e,experimentClient:t})=>a.createElement("div",{style:{paddingTop:"12px"}},a.createElement(lt.q,{withScore:!0,onSubmit:t=>e(t.score,t.text),title:a.createElement("span",null,"How do you like Grammarly?"),hideTextBoxTitle:!0,hideLogo:!0,hideDomainHelpText:!0,showPostSubmitScreen:!1,submitButtonKind:"primary",experimentClient:t})),ct=(e,t,i,r,n,a,s)=>{const o=[];return{submitFeedback(l,d){e.vBarCardRewriteFeedbackSubmitted({vBar:a.sideline,rewrite:s,message:d,score:l}),r.sendFeedback({feedbackData:{score:l,message:d,domain:n,sidelineType:a.sideline.kind},message:"Feedback submitted"}),o.push(t.enqueue("feedbackSubmitted").subscribe()),i()},dispose(){o.forEach((e=>e.unsubscribe()))}}};var ht=i(20715),gt=i(1393);var mt=i(25989);function ut(e,t,i,r,a=!0){const s=i.getSidelineCalliopeAlerts(e.sideline.sequentialId);return"improve"===t.kind&&s.length>0?ht.of(r.getImproveRewriteFromCalliopeAlert(s[0],e.sideline.text,e.sideline.textRange)):mt.D(r.getRewrite(t,e.sideline.text,e.sideline.textRange,a)).pipe(c.q(1),l.w(n.yR))}var pt=i(85782),ft=i(12171);function wt(e,t=300){return e.pipe(pt.v((({rewrite:e,sidelineCard:t})=>`${e.id}-${t.sideline.id}`)),ft.zg((e=>e.pipe(k.b(t)))))}function vt(e,t){return`rewrite-loading-${e.type.kind}-${t.sideline.id}`}const St={selectedRewriteType:{kind:"improve"},improveRewriteInfo:{type:{kind:"improve"},kind:"idle"},rephraseRewriteInfo:{type:{kind:"rephrase"},kind:"idle"},shortenRewriteInfo:m.YP,friendlyRewriteInfo:m.YP,formalRewriteInfo:m.YP,customPromptRewriteInfo:m.YP,rewriteApplied:!1,rewriteCopied:!1,feedbackForm:m.YP};class bt{constructor(e){var t,i;this._params=e,this._subs=new s.w,this._logger=S.Y.create("SidelineCardViewModelImpl"),this._sidelineCardStateMap=new Map,this._selectedRewriteSubscriptionMap=new Map,this._customPromptRewriteSubscriptionMap=new Map,this._sidelineCard=p.h.create(m.YP),this._performanceMarkNames=new Set,this._notifyRewriteReadyShownSubject=new Ke.xQ,this._notifyRewriteEmptyShownSubject=new Ke.xQ,this._notifyRewriteErrorShownSubject=new Ke.xQ,this.sidelineCard=this._sidelineCard.view(),this._subs.add((t=this._params.sidelineCollectionViewModel,b.aj([t.activeSideline,t.pinnedSideline]).pipe(k.b(0),y.U((([e,t])=>(0,n.zG)(t,m.UI((e=>({sideline:e,isPinned:!0}))),m.wp((()=>(0,n.zG)(e,m.UI((e=>({sideline:e,isPinned:!1}))))))))),y.U(m.tS((({sideline:e,isPinned:i})=>(0,n.zG)(t.getSidelineHtmlElement(e.sequentialId),m.UI((t=>({sideline:e,isSidelinePinned:i,referenceElement:t}))))))),l.w(m.g_((()=>ht.of(m.YP)),(e=>D.timer(e.isSidelinePinned?0:250).pipe(x.h(m.G(e)))))))).subscribe(g.wW(this._sidelineCard))),this._subs.add(wt(this._notifyRewriteReadyShownSubject).subscribe((({rewrite:e,sidelineCard:t})=>{this._logger.debug("Tracking vBarCardRewriteReadyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteReadyShown({vBar:t.sideline,rewrite:e,durationMs:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t)})}))),this._subs.add(wt(this._notifyRewriteEmptyShownSubject).subscribe((({rewrite:e,sidelineCard:t})=>{this._logger.debug("Tracking vBarCardRewriteEmptyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteEmptyShown({vBar:t.sideline,rewrite:e,durationMs:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t)})}))),this._subs.add(wt(this._notifyRewriteErrorShownSubject).subscribe((({rewrite:e,sidelineCard:t})=>{this._logger.debug("Tracking vBarCardRewriteErrorShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteErrorShown({vBar:t.sideline,rewrite:e,durationMs:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t)})}))),(0,Ze.OB)().experimentClient.isGateEnabled(tt.K.G2VbarsSelectionPreload)&&this._subs.add((i=this._params.sidelineCollectionViewModel.selectionSideline,i.pipe(l.w(m.g_((()=>ht.of(m.YP)),(e=>Ge.T(C.R(document,"mouseup"),C.R(document,"mousemove").pipe(d.h((e=>0===e.buttons)))).pipe(c.q(1),x.h(m.G(e)))))),k.b(gt.m9(.2)),o.oA)).subscribe((e=>{this._logger.debug('Preloading "improve" rewrite for selection sideline.',{sidelineId:e.id}),this._params.rewriteService.getRewrite({kind:"improve"},e.text,e.textRange)})))}_getSidelineCardState(e){var t;return null!==(t=this._sidelineCardStateMap.get(e.sideline.id))&&void 0!==t?t:this._initSidelineCardState(e)}_initSidelineCardState(e){this._logger.debug("Initializing sideline card state.",{sidelineId:e.sideline.id});const t=p.h.create(St);return this._sidelineCardStateMap.set(e.sideline.id,t),t}_setRewriteInfo(e,t,i){this._logger.debug("Setting rewrite info.",{sidelineId:i.sideline.id,rewriteType:e,rewrite:t});const r=this._getSidelineCardState(i);switch(e.kind){case"improve":r.lens("improveRewriteInfo").set(t);break;case"rephrase":r.lens("rephraseRewriteInfo").set(t);break;case"shorten":r.lens("shortenRewriteInfo").set(m.G(t));break;case"friendly":r.lens("friendlyRewriteInfo").set(m.G(t));break;case"formal":r.lens("formalRewriteInfo").set(m.G(t));break;case"customPrompt":r.lens("customPromptRewriteInfo").set(m.G(t));break;default:(0,me.L0)(e)}}_showAllRewriteTypes(e){this._setRewriteInfo({kind:"shorten"},{type:{kind:"shorten"},kind:"idle"},e),this._setRewriteInfo({kind:"friendly"},{type:{kind:"friendly"},kind:"idle"},e),this._setRewriteInfo({kind:"formal"},{type:{kind:"formal"},kind:"idle"},e)}_getFeedbackForm(e,t){const i=new Je.y(p.h.create([]),st.createFactory(),1,5e3),r=()=>this._getSidelineCardState(t).lens("feedbackForm").set(m.YP);return a.createElement("div",{style:{padding:"18px"}},a.createElement("div",{style:{display:"flex",justifyContent:"end",flex:"flex-end"}},a.createElement(Qe.J,{icon:Xe.V,accessibilityLabel:"Close icon",onClick:r})),a.createElement(dt,{submitFeedback:ct(this._params.trackingService,i,r,this._params.telemetryService,this._params.integrationInfo.domain,t,e).submitFeedback,experimentClient:(0,Ze.OB)().experimentClient}))}_performanceMark(e){performance.mark(e),this._performanceMarkNames.add(e)}_clearPerformanceMarks(e){if(e)performance.clearMarks(e),this._performanceMarkNames.delete(e);else{for(const e of this._performanceMarkNames)performance.clearMarks(e);this._performanceMarkNames.clear()}}_getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t){const i=vt(e,t),r=performance.getEntriesByName(i).length>0?performance.measure(`rewrite-shown-${e.type.kind}-${t.sideline.id}`,i).duration:void 0;return this._clearPerformanceMarks(i),r}getSidelineCardState(e){return this._getSidelineCardState(e)}activateSidelineCard(e,t){this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sideline.sequentialId,t)}deactivateSidelineCard(e,t){(!e.isSidelinePinned||e.isSidelinePinned&&t)&&this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sideline.sequentialId,t)}applyRewrite(e,t){this._logger.debug("Apply rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteApplied({vBar:t.sideline,rewrite:e}),this._params.performReplacement({pos:e.textRange,value:e.rewriteText,oldValue:e.text},{sidelineType:t.sideline.kind}).then((e=>{const t=(Array.isArray(e)?e:[e]).filter(et.j.isFail);if(t.length>0){let e="Replacement(s) failed.";const i=t.map((e=>e.reason)).filter(Boolean);throw i.length>0&&(e+=` Reason(s): ${i.join(", ")}.`),new Error(e)}this._params.telemetryService.info({message:"Applying rewrite succeeded."})})).catch((e=>this._params.telemetryService.error({message:"Applying rewrite failed.",error:e}))),this._getSidelineCardState(t).lens("rewriteApplied").set(!0),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sideline.sequentialId,!0)}async copyRewrite(e,t){this._logger.debug("Copy rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteCopied({vBar:t.sideline,rewrite:e});try{await(0,it.vQ)(e.rewriteText),this._params.telemetryService.info({message:"Copying rewrite succeeded."})}catch(e){this._params.telemetryService.error({message:"Copying rewrite failed.",error:e}),this._logger.error("Failed to copy rewrite.",e)}this._getSidelineCardState(t).lens("rewriteCopied").set(!0)}regenerateRewrite(e,t){this._logger.debug("Regenerate rewrite.",{rewrite:e,sidelineCard:t});const i=this._getSidelineCardState(t);this._params.trackingService.vBarCardRewriteRegenerated({vBar:t.sideline,rewrite:e}),this._subs.add(ut(t,i.lens("selectedRewriteType").get(),this._params.sidelineCollectionViewModel,this._params.rewriteService,!1).subscribe((e=>{this._setRewriteInfo(e.type,e,t),this._params.telemetryService.info({message:"Regenerating rewrite succeeded."})})))}submitCustomPrompt(e,t){var i;const r={kind:"customPrompt",prompt:e};null===(i=this._customPromptRewriteSubscriptionMap.get(t.sideline.id))||void 0===i||i.unsubscribe();const n=ut(t,r,this._params.sidelineCollectionViewModel,this._params.rewriteService).subscribe((e=>this._setRewriteInfo(r,e,t)));this._subs.add(n)}notifySelectedRewriteTypeChanged(e,t){(0,ot.L5)(e)&&this._showAllRewriteTypes(t),this._getSidelineCardState(t).lens("selectedRewriteType").set(e)}notifyCustomPromptChanged(e,t){this._getSidelineCardState(t).lens("customPromptRewriteInfo").set(m.YP)}notifyRewriteLoadingShown(e,t){this._logger.debug("notifyRewriteLoadingShown()",{rewrite:e,sidelineId:t.sideline.id});const i=vt(e,t);this._clearPerformanceMarks(i),this._performanceMark(i)}notifyRewriteEmptyShown(e,t){this._notifyRewriteEmptyShownSubject.next({rewrite:e,sidelineCard:t})}notifyRewriteReadyShown(e,t){this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card rewrite succeeded."}),this._notifyRewriteReadyShownSubject.next({rewrite:e,sidelineCard:t})}notifyRewriteErrorShown(e,t){this._notifyRewriteErrorShownSubject.next({rewrite:e,sidelineCard:t})}notifySidelineCardShown(e){var t;this._logger.debug("notifySidelineCardShown()",{sidelineId:e.sideline.id}),null===(t=this._selectedRewriteSubscriptionMap.get(e.sideline.id))||void 0===t||t.unsubscribe();const i=this._getSidelineCardState(e).lens("selectedRewriteType").pipe(d.h((0,$e.ff)(ot.J8)),l.w((t=>ut(e,t,this._params.sidelineCollectionViewModel,this._params.rewriteService).pipe(y.U((e=>({rewriteType:t,rewrite:e}))))))).subscribe((({rewriteType:t,rewrite:i})=>this._setRewriteInfo(t,i,e)));this._selectedRewriteSubscriptionMap.set(e.sideline.id,i),this._params.trackingService.vBarCardShown({vBar:e.sideline}),this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card succeeded."})}notifySidelineCardClosed(e){const t=this._getSidelineCardState(e),i=t.lens("rewriteApplied").get();this._logger.debug("notifySidelineCardClosed()",{sidelineId:e.sideline.id,isRewriteApplied:i}),i||this._params.trackingService.vBarCardClosed({vBar:e.sideline}),t.set(St),this._clearPerformanceMarks()}notifyMoreTabClicked(e){this._showAllRewriteTypes(e)}notifyFeedbackButtonClicked(e,t){this._getSidelineCardState(t).lens("feedbackForm").set(m.G(this._getFeedbackForm(e,t)))}dispose(){this._subs.unsubscribe()}}var _t=i(10595);function yt(e){return"signaling"===e.kind}class Ct{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("SidelineCollectionViewModelImpl"),this._htmlElementBySidelineSequentialId=new Map,this._paragraphSidelines=p.h.create([]),this._paragraphSidelineBySequentialId=new Map,this._pinnedSidelineSequentialId=p.h.create(m.YP),this._pinnedSideline=p.h.combine(this._pinnedSidelineSequentialId,this._paragraphSidelines,(e=>(0,n.zG)(e,m.tS((e=>-1===e?this._selectionSideline.get():m.ij(this._paragraphSidelineBySequentialId.get(e))))))),this._activeSidelineSequentialId=p.h.create(m.YP),this._activeSideline=p.h.combine(this._pinnedSideline,this._activeSidelineSequentialId,this._paragraphSidelines,((e,t)=>(0,n.zG)(e,m.wp((()=>(0,n.zG)(t,m.tS((e=>-1===e?this._selectionSideline.get():m.ij(this._paragraphSidelineBySequentialId.get(e)))))))))),this._emphasizedSidelineSequentialId=p.h.create(m.YP),this._emphasizedSideline=p.h.combine(this._pinnedSideline,this._activeSideline,this._emphasizedSidelineSequentialId,this._paragraphSidelines,((e,t,i)=>(0,n.zG)(e,m.wp((()=>(0,n.zG)(t,m.wp((()=>(0,n.zG)(i,m.tS((e=>-1===e?this._selectionSideline.get():m.ij(this._paragraphSidelineBySequentialId.get(e))))))))))))),this._selectionSideline=p.h.create(m.YP),this._shouldHideSidelinesDueToScrolling=p.h.create(!1),this._shouldHideSidelines=p.h.create(!1),this._sidelineCardActiveNotifications=new Ke.xQ,this._deactivateSidelineSubs=new s.w,this._notifySidelineShownSubject=new Ke.xQ,this.paragraphSidelines=this._paragraphSidelines.view(),this.pinnedSideline=this._pinnedSideline.view(),this.activeSideline=this._activeSideline.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.selectionSideline=this._selectionSideline.view(),this.shouldHideSidelines=this._shouldHideSidelines.view(),this._subs.add(b.aj([this._params.paragraphHighlightCollectionViewModel.paragraphHighlights,this._params.alertCollectionService.calliopeAlerts]).pipe(y.U((([e])=>e.map((e=>(this._params.featureFlags.signalingSidelines||this._params.featureFlags.idleSidelines)&&e.isScrolledIntoView?(0,n.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),m.g_((()=>(this._params.telemetryService.warn({message:"Creating sideline failed."}),this._logger.warn("Failed to create paragraph sideline; skipping.",{paragraphId:e.paragraphId}),m.YP)),(t=>function(e,t,i,r,n){const a=`g2-paragraph-sideline-${e.textRange.start}-${e.textRange.end}`,s=i.getCalliopeAlertsWithinTextRange(e.textRange).length>0,o={kind:s?"signaling":"idle",id:a,sequentialId:e.sequentialId,highlightViewportRect:t,text:e.text,textRange:e.textRange};return s?r?m.G(o):n?m.G({...o,kind:"idle"}):m.YP:n?m.G(o):m.YP}(t,e.viewportRect,this._params.alertCollectionService,this._params.featureFlags.signalingSidelines,this._params.featureFlags.idleSidelines))),m.WG):null)).filter(ie.Nf)))).subscribe(g.wW(this._paragraphSidelines))),this._subs.add(this._paragraphSidelines.subscribe((e=>{this._paragraphSidelineBySequentialId.clear();for(const t of e)this._paragraphSidelineBySequentialId.set(t.sequentialId,t)}))),this._subs.add(this._params.paragraphHighlightCollectionViewModel.emphasizedParagraphHighlight.pipe(y.U(m.UI((e=>e.sequentialId)))).subscribe(g.wW(this._emphasizedSidelineSequentialId))),this._setupSelectionSideline(),this._subs.add(Ge.T(this._params.textFieldLayout.scroll.changes,C.R((0,I.Jj)(this._params.textFieldElement),"scroll",{capture:!0})).pipe(Me.b((()=>this._shouldHideSidelinesDueToScrolling.set(!0))),l.w((()=>D.timer(1e3).pipe(Me.b((()=>this._shouldHideSidelinesDueToScrolling.set(!1))))))).subscribe()),this._subs.add(b.aj([this._params.legacyAssistantOpenState,this._params.assistantState,this._shouldHideSidelinesDueToScrolling]).pipe(y.U((([e,t,i])=>"open"===e||"opened"===t.kind||i))).subscribe(g.wW(this._shouldHideSidelines))),this._subs.add(this._shouldHideSidelines.pipe(d.h(Boolean)).subscribe((()=>{this._pinnedSidelineSequentialId.set(m.YP),this._activeSidelineSequentialId.set(m.YP)}))),this._subs.add(this._params.textObserver.contentChanges.immediate.subscribe((({changes:e})=>{e.length>0&&(this._pinnedSidelineSequentialId.set(m.YP),this._activeSidelineSequentialId.set(m.YP))}))),this._subs.add(this._notifySidelineShownSubject.pipe(pt.v((e=>function(e){return"selection"===e.kind}(e)?e.sequentialId:e.id)),ft.zg((e=>e.pipe(k.b(300))))).subscribe((e=>{this._logger.debug("Tracking vBarShown().",{sideline:e}),this._params.trackingService.vBarShown({vBar:e})}))),this._setupDebugLogs()}_setupDebugLogs(){this._subs.add(this._paragraphSidelines.subscribe((e=>this._logger.debug("Paragraph sidelines updated.",e)))),this._subs.add(this._pinnedSideline.subscribe((e=>this._logger.debug("Pinned sideline updated.",m.WG(e))))),this._subs.add(this._activeSideline.subscribe((e=>this._logger.debug("Active sideline updated.",m.WG(e))))),this._subs.add(this._emphasizedSideline.subscribe((e=>this._logger.debug("Emphasized sideline updated.",m.WG(e))))),this._subs.add(this._selectionSideline.subscribe((e=>this._logger.debug("Selection sideline updated.",m.WG(e)))))}_setupSelectionSideline(){this._params.featureFlags.selectionSidelines&&this._subs.add(b.aj([this._params.selectionHighlightViewModel.selectionHighlight,this._activeSideline]).pipe(d.h((([e,t])=>(0,n.zG)(r.Yt(m.Kw)({selectionSideline:this._selectionSideline.get(),activeSideline:t}),m.g_(n.W8,(({selectionSideline:e,activeSideline:t})=>e.id!==t.id))))),y.U((([e])=>(0,n.zG)(e,m.hX((e=>e.isScrolledIntoView)),m.UI((e=>function(e){return{kind:"selection",id:`g2-selection-sideline-${e.textRange.start}-${e.textRange.end}`,sequentialId:-1,text:e.text,textRange:e.textRange,highlightViewportRect:{top:e.viewportRect.top,left:e.viewportRect.left,width:e.viewportRect.width,height:e.viewportRect.height}}}(e))))))).subscribe(g.wW(this._selectionSideline)))}_doesSequentialIdMatchRelevantSidelineSequentialId(e,t){return(0,n.zG)(t,m.g_(n.jv,(t=>t===e)))}_getSidelineBySequentialId(e){return-1===e?this._selectionSideline.get():m.ij(this._paragraphSidelineBySequentialId.get(e))}_deactivateSideline(e,t=!1){this._logger.debug("Deactivating sideline.",{sidelineSequentialId:e,immediate:t}),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._activeSidelineSequentialId.get())?this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(d.h((t=>t===e)),c.q(1),x.h(!1),_t.L(t?0:gt.E0,ht.of(!0))).subscribe((t=>{t?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineSequentialId:e}),this._activeSidelineSequentialId.set(m.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineSequentialId:e})})):(this._params.telemetryService.warn({message:"Deactivation of an inactive sideline attempted."}),this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineSequentialId:e}))}_unpinSideline(e){this._logger.debug("Unpinning sideline.",{sidelineSequentialId:e}),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._pinnedSidelineSequentialId.get())?(this._pinnedSidelineSequentialId.set(m.YP),this._activeSidelineSequentialId.set(m.YP)):(this._params.telemetryService.warn({message:"Unpinning of an unpinned sideline attempted."}),this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineSequentialId:e}))}_pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineSequentialId:e}),this._pinnedSidelineSequentialId.set(m.G(e))}activateSideline(e){this._logger.debug("Activating sideline.",{sideline:e}),this._activeSidelineSequentialId.set(m.G(e.sequentialId)),this._deactivateSidelineSubs.unsubscribe()}deactivateSideline(e){this._deactivateSideline(e.sequentialId)}pinSideline(e){this._pinSideline(e.sequentialId)}unpinSideline(e){this._unpinSideline(e.sequentialId)}getSideline(e){return this._getSidelineBySequentialId(e)}getSidelineCalliopeAlerts(e){return(0,n.zG)(this._getSidelineBySequentialId(e),m.hX(yt),m.g_((()=>[]),(e=>this._params.alertCollectionService.getCalliopeAlertsWithinTextRange(e.textRange))))}getSidelineHtmlElement(e){return m.ij(this._htmlElementBySidelineSequentialId.get(e))}notifySidelineMounted(e){this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline succeeded."})}notifySidelineShown(e){this._logger.debug("Sideline shown (became visible)",{sideline:e}),this._notifySidelineShownSubject.next(e)}notifySidelineHidden(e){this._logger.debug("Sideline hidden (became invisible)",{sideline:e}),this._params.trackingService.vBarHidden({vBar:e})}notifySidelineRefChanged(e,t){this._htmlElementBySidelineSequentialId.set(e.sequentialId,t)}notifySidelineCardActive(e,t){this._sidelineCardActiveNotifications.next(e),t&&this._pinSideline(e)}notifySidelineCardInactive(e,t){m.pC(this._pinnedSideline.get())?this._unpinSideline(e):m.pC(this._activeSideline.get())&&this._deactivateSideline(e,t)}dispose(){this._deactivateSidelineSubs.unsubscribe(),this._subs.unsubscribe()}}class kt{constructor(e){this._params=e,this._subs=new s.w,this._logger=S.Y.create("G2FeatureImpl"),this._servicesAndViewModels=p.h.create(m.YP),this._integration="googleDocs"===this._params.integrationInfo.kind?new ee({integrationInfo:this._params.integrationInfo,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,textObserver:this._params.textObserver,selectionSource:this._params.selectionSource,selectionService:this._params.selectionService,telemetry:this._params.telemetry}):new V({integrationInfo:this._params.integrationInfo,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,selectionService:this._params.selectionService,telemetry:this._params.telemetry}),this._replacementService=this._params.replacementServiceInjector.create(v.P.g2),this._trackingService=new Be({checkingService:this._params.checkingService,gnarClient:this._params.gnarClient,integrationInfo:this._params.integrationInfo,telemetryService:this._params.telemetry}),this._inlineAlertsFilter=p.h.create(n.W8),this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this.suppressGgoInlineEntryPoints=this._params.featureFlags.selectionSidelines,this._logger.debug("G2 feature initialized.",this._params.integrationInfo);const t=this._params.checkingService.pipe(o.oA,l.w((e=>e.readyState)),d.h((e=>e===f.kQ.firstTextCheckCompleted)),c.q(1));this._subs.add(t.pipe(l.w((()=>this._integration.isEnabled.pipe(h.x())))).subscribe((e=>{e?(this._logger.debug("G2 integration enabled, initializing services and VMs."),this._init()):(this._logger.debug("G2 integration disabled, disposing services and VMs."),this._disposeServicesAndViewModels())}))),this._subs.add(this._servicesAndViewModels.pipe(l.w(m.g_((()=>this._params.alertClassification.visibleInlineAlertsFilter),(e=>e.alertCollectionService.inlineAlertsFilter)))).subscribe(g.wW(this._inlineAlertsFilter)))}_init(){const e=new Ee({checkingService:this._params.checkingService,textChangeBuffer:this._params.textChangeBuffer,telemetry:this._params.telemetry,integration:this._integration}),t=new se({textObserver:this._params.textObserver,integration:this._integration}),i=new ne({alertProcessor:this._params.alertProcessor,alertClassification:this._params.alertClassification,featureFlags:this._params.featureFlags}),r=new w.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0,S.Y.create(`${kt.name}.ParagraphHighlightCollectionGeometry`)),n=new je({paragraphCollectionService:t,paragraphHighlightCollectionGeometry:r,textFieldLayout:this._params.textFieldLayout,mouseData:this._params.mouseData,textFieldElement:this._params.textFieldElement,integration:this._integration,telemetry:this._params.telemetry}),a=new w.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0,S.Y.create(`${kt.name}.SelectionHighlightGeometry`)),s=new Ye({selectionHighlightGeometry:a,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,integration:this._integration,paragraphHighlightCollectionViewModel:n}),o=new Ct({integrationName:this._params.integrationInfo.integrationName,paragraphCollectionService:t,alertCollectionService:i,paragraphHighlightCollectionViewModel:n,textObserver:this._params.textObserver,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,selectionHighlightViewModel:s,legacyAssistantOpenState:this._params.legacyAssistantOpenState,assistantState:this._params.assistantState,telemetryService:this._params.telemetry,user:this._params.user,featureFlags:this._params.featureFlags,trackingService:this._trackingService}),l=new bt({rewriteService:e,sidelineCollectionViewModel:o,performReplacement:(e,t)=>this._replacementService.performReplacement(e,t),telemetryService:this._params.telemetry,integrationInfo:this._params.integrationInfo,trackingService:this._trackingService});this._servicesAndViewModels.set(m.G({rewriteService:e,paragraphCollectionService:t,alertCollectionService:i,paragraphHighlightCollectionGeometry:r,paragraphHighlightCollectionViewModel:n,selectionHighlightGeometry:a,selectionHighlightViewModel:s,sidelineCollectionViewModel:o,sidelineCardViewModel:l}))}_disposeServicesAndViewModels(){(0,n.zG)(this._servicesAndViewModels.get(),u.bw((e=>{e.rewriteService.dispose(),e.paragraphCollectionService.dispose(),e.alertCollectionService.dispose(),e.paragraphHighlightCollectionGeometry.dispose(),e.paragraphHighlightCollectionViewModel.dispose(),e.selectionHighlightGeometry.dispose(),e.selectionHighlightViewModel.dispose(),e.sidelineCollectionViewModel.dispose(),e.sidelineCardViewModel.dispose()}))),this._servicesAndViewModels.set(m.YP)}get _sidelinesUI(){return this._servicesAndViewModels.view(m.UI((({sidelineCollectionViewModel:e})=>a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(Pe,{paragraphSidelines:e.paragraphSidelines,pinnedSideline:e.pinnedSideline,activeSideline:e.activeSideline,emphasizedSideline:e.emphasizedSideline,shouldHideSidelines:e.shouldHideSidelines,selectionSideline:e.selectionSideline,onPinSideline:t=>e.pinSideline(t),onActivateSideline:t=>e.activateSideline(t),onDeactivateSideline:t=>e.deactivateSideline(t),onMountSideline:t=>e.notifySidelineMounted(t),onShowSideline:t=>e.notifySidelineShown(t),onHideSideline:t=>e.notifySidelineHidden(t),onSidelineRefChange:(t,i)=>e.notifySidelineRefChanged(t,i)})))))}get ui(){const e=this._integration.uiContainer;return p.h.combine(this._sidelinesUI,this._sidelineCardUI,((t,i)=>(0,n.zG)(r.Yt(m.G5)({sidelinesUI:t,sidelineCardUI:i}),m.UI((({sidelinesUI:t,sidelineCardUI:i})=>a.createElement(e,{key:"g2-ui"},t,i))))))}get _sidelineCardUI(){return this._servicesAndViewModels.view(m.UI((({sidelineCardViewModel:e})=>a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(Te,{sidelineCard:e.sidelineCard,getSidelineCardState:t=>e.getSidelineCardState(t),onActivateSidelineCard:(t,i)=>e.activateSidelineCard(t,i),onDeactivateSidelineCard:(t,i)=>e.deactivateSidelineCard(t,i),onChangeSelectedRewriteType:(t,i)=>e.notifySelectedRewriteTypeChanged(t,i),onMountRewriteLoading:(t,i)=>e.notifyRewriteLoadingShown(t,i),onMountRewriteEmpty:(t,i)=>e.notifyRewriteEmptyShown(t,i),onMountRewriteReady:(t,i)=>e.notifyRewriteReadyShown(t,i),onMountRewriteError:(t,i)=>e.notifyRewriteErrorShown(t,i),onApplyRewrite:(t,i)=>e.applyRewrite(t,i),onCopyRewrite:(t,i)=>e.copyRewrite(t,i),onRegenerateRewrite:(t,i)=>e.regenerateRewrite(t,i),onChangeCustomPrompt:(t,i)=>e.notifyCustomPromptChanged(t,i),onSubmitCustomPrompt:(t,i)=>e.submitCustomPrompt(t,i),onClickMoreTab:t=>e.notifyMoreTabClicked(t),onShow:t=>e.notifySidelineCardShown(t),onClose:t=>e.notifySidelineCardClosed(t),onClickFeedbackButton:(t,i)=>e.notifyFeedbackButtonClicked(t,i)})))))}dispose(){this._disposeServicesAndViewModels(),this._integration.dispose(),this._subs.unsubscribe()}}},32066:(e,t,i)=>{var r,n,a;i.d(t,{J8:()=>l,L5:()=>o,es:()=>s}),function(e){e.is=function(e){return"improve"===e.kind}}(r||(r={})),function(e){e.is=function(e){return"rephrase"===e.kind}}(n||(n={})),function(e){e.is=function(e){return"customPrompt"===e.kind}}(a||(a={}));const s=r.is,o=n.is,l=a.is},72235:(e,t,i)=>{i.d(t,{B:()=>c,I:()=>u});var r=i(49231),n=i(82089),a=i(63843),s=i(40478),o=i(74912),l=i(99627),d=i(8780);const c=16;function h(e,t,i){return(0,l.Sh)(d.sideline,e?d.sidelineEmphasized:d.sidelineIdle,"selection"===t?d.sidelineWithSelectionSignal:void 0,i?d.sidelineWithSignalBar:void 0).className}function g(e,t,i,r){return(0,l.Sh)(d.sidelineSignalBar,function(e,t){if(t)return d.sidelineSignalBarLoading;switch(e){case"signaling":return d.sidelineSignalBarAttention;case"selection":case"idle":return;default:(0,a.L0)(e)}}(t,r),e?d.sidelineSignalBarEmphasized:void 0,i?void 0:d.sidelineSignalBarHidden).className}function m(e,t){return(0,l.Sh)(d.sidelineArrow,e?d.sidelineArrowVisible:void 0,t?d.sidelineArrowBottom:void 0).className}const u=r.forwardRef((function({emphasized:e,heightInPixels:t,sidelineType:i,sidelineId:a,isLoading:l,onClick:d,onMouseOver:u,onMouseOut:p,onFocus:f,onBlur:w,onMount:v,onShow:S,onHide:b},_){const y=r.useRef(!1),C=r.useRef(a),k=("signaling"===i||l&&e)&&!(e&&!(t>=24)),x=k||e;return n.P.useEffectOnDidMount((()=>v())),n.P.useEffectOnWillUnmount((()=>{y.current&&b()})),((e,t,i,n)=>{r.useEffect((()=>{e.current!==t&&(e.current=t,t?i():n())}),[t,i,n])})(y,x,S,b),r.useEffect((()=>{C.current!==a&&x&&S()}),[x,a]),r.createElement("button",{"data-testid":"grammarly-g2-sideline",className:h(e,i,k),style:{height:t,width:c},disabled:!e,onClick:e?d:void 0,onFocus:e?f:void 0,onBlur:e?w:void 0,onMouseOver:u,onMouseOut:p,"aria-label":"See rewrite suggestions",ref:_},r.createElement("div",{className:g(e,i,k,l),role:"status","aria-label":"Rewrite suggestions available"}),r.createElement(s.J,{className:m(e,k),icon:o.b,accessibilityLabel:"",size:"small",variant:"selection"===i?"inverse":"default"}))}))},4762:(e,t,i)=>{i.r(t),i.d(t,{SidelineCardWrapper:()=>pe});var r=i(90023),n=i(49231),a=i(65647),s=i(14765),o=i(96030),l=i(58303),d=i(43818);const c=({show:e,transitionDurationMs:t=250,display:i="inline-block",children:r})=>{const[a,s]=n.useState(!1),[o,l]=n.useState(!1);n.useEffect((()=>{let i;s(!0),e||(i=self.setTimeout((()=>s(!1)),t)),l(!e);const r=self.setTimeout((()=>l(e)),0);return()=>[i,r].forEach(clearTimeout)}),[e]);const d={display:i,opacity:o?1:0,transition:`opacity ${t}ms`};return a&&r?n.createElement("div",{style:d,"data-testid":"wrapper"},r):null};var h=i(82089),g=i(63843),m=i(70201),u=i(6584),p=i(5470),f=i(99627),w=i(10555);const v=({className:e,...t})=>n.createElement(p.z,{...(0,f.Sh)(w.sidelineCardButton,e),variant:"tertiary",size:"small",...t});var S=i(48868),b=i(63640),_=i(56990),y=i(78830),C=i(92935),k=i(3190),x=i(40478),R=i(34578);function E(e){return e?["Assistance unavailable",e]:["Couldn’t generate ideas","Please wait a moment, then try again."]}const I=({errorDetails:e,onMount:t})=>(h.P.useEffectOnDidMount((()=>t())),n.createElement(S.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},n.createElement(x.J,{icon:R.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),n.createElement(b.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,k.li)(E(e))),n.createElement(b.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,k.Yg)(E(e)))));var F=i(56732),B=i(97500);const T=({onMount:e})=>(h.P.useEffectOnDidMount((()=>e())),n.createElement(S.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton",height:"100%"},n.createElement(B.g,{accessibilityLabel:"Loading rewrite",label:"Loading rewrite",width:"100%"},n.createElement(S.k,{gap:4,height:"100%"},n.createElement(B.g.Rectangle,{width:3,height:"100%"}),n.createElement(S.k,{direction:"column",gap:4,width:"100%"},n.createElement(B.g.Heading,{variant:"heading-small",width:"50%"}),n.createElement(S.k,{direction:"column",width:"100%",align:"start"},n.createElement(B.g.Text,{variant:"text-small",width:"100%"}),n.createElement(B.g.Text,{variant:"text-small",width:"100%"}),n.createElement(B.g.Text,{variant:"text-small",width:"100%"})),n.createElement(B.g.Button,{size:"small",width:60}))))));var P=i(85101),M=i(22206),G=i(52735),A=i(10695);const L=({className:e})=>n.createElement(x.J,{...(0,f.Sh)(A.sidelineCardGrammarlyLogo,e),size:"small",icon:G.p,accessibilityLabel:"Grammarly logo","data-testid":"grammarly-g2-sideline-card-grammarly-logo"});var D=i(62085),O=i(43831);const N=e=>{const[t,i]=n.useState(!1),r=n.useRef(void 0),a=n.useCallback((()=>{void 0!==r.current&&(self.clearTimeout(r.current),r.current=void 0)}),[]);n.useEffect(a,[]);return n.createElement(S.k,{className:O.sidelineCardRewriteCopyButton},t&&n.createElement(S.k,{className:O.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},n.createElement(b.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),n.createElement(P.h,{variant:"tertiary",accessibilityLabel:"Copy",icon:D.c,size:"small",onClick:async()=>{await e.onClick(),i(!0),a(),r.current=self.setTimeout((()=>{i(!1)}),3e3)}}))};var z=i(59833),H=i(46393),q=i(7545);const V=e=>{const{children:t,renderer:i}=e,r=t.split("\n");return n.createElement(n.Fragment,null,r.map(((e,t)=>t>0?0===e.length?n.createElement("br",{key:`${t}_br`}):[n.createElement("br",{key:`${t}_br`}),n.createElement(n.Fragment,{key:t},i(e))]:0===e.length?[]:n.createElement(n.Fragment,{key:t},i(e)))).flat())},U={color:q.I.Text.Brand.Default,background:"rgba(177, 240, 232, 0.6)",fontWeight:"bold"},W={color:"#696969",backgroundColor:"rgba(156, 156, 156, 0.2)",textDecoration:"line-through"},j={color:q.I.Text.Base.Default,backgroundColor:q.I.Background.Base.Default},Y=({diff:e,displayDeletes:t})=>n.createElement("p",null,(0,r.zG)(e,z.Su(((e,i)=>(0,r.zG)(i,H.F.matchOperation({onDelete:t?t=>n.createElement(b.x,{as:"span",variant:"text-small",key:e,style:W},t):()=>null,onInsert:t=>n.createElement(V,{key:e,renderer:e=>n.createElement(b.x,{as:"span",variant:"text-small",style:U},e)},t),onRetain:t=>n.createElement(V,{key:e,renderer:e=>n.createElement(b.x,{as:"span",variant:"text-small",style:j},e)},t)}))))));var $=i(69587);function J(e,t){return"signaling"===e&&"improve"===t.kind?$.sidelineCardRewriteReadyContentTitleAttention:$.sidelineCardRewriteReadyContentTitleDefault}const K=e=>{const[t,i]=n.useState(null);return h.P.useEffectOnDidMount(e.onMount),n.createElement(S.k,{gap:4,align:"stretch",height:"100%","data-testid":"grammarly-g2-sideline-card-rewrite-ready"},n.createElement("div",{...(0,f.Sh)($.sidelineCardRewriteReadySignalBar,(s=e.sidelineType,o=e.rewriteType,"signaling"===s&&"improve"===o.kind?$.sidelineCardRewriteReadySignalBarAttention:$.sidelineCardRewriteReadySignalBarDefault)),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),n.createElement(S.k,{flex:"1",direction:"column",justify:"space-between","data-testid":"grammarly-g2-sideline-card-rewrite-ready-container"},n.createElement("div",{className:(a=null==t?void 0:t.getBoundingClientRect().height,a&&a>=190?$.sidelineCardRewriteReadyContentScrollable:$.sidelineCardRewriteReadyContent),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:i},n.createElement(b.x,{...(0,f.Sh)($.sidelineCardRewriteReadyContentTitle,J(e.sidelineType,e.rewriteType)),as:"strong",variant:"text-small"},e.title),(0,r.zG)(e.diffProps,l.UI((e=>n.createElement(Y,{key:"diff",diff:e.diff,displayDeletes:e.displayDeletes}))),l.fS((()=>n.createElement(b.x,{as:"p",variant:"text-small"},e.newText))))),n.createElement(S.k,{align:"end",justify:"space-between",height:"1.5rem","data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},n.createElement(S.k,{align:"end",justify:"start",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},n.createElement(v,{text:"Accept",onClick:e.onApply,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn"})),n.createElement(S.k,{align:"center",justify:"end",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},n.createElement(p.z,{"data-testid":"grammarly-g2-sideline-feedback-btn",variant:"tertiary",text:"Feedback",size:"small",onClick:()=>e.onClickFeedbackButton()}),n.createElement(N,{onClick:e.onCopy}),e.onRegenerate&&n.createElement(S.k,{className:$.sidelineCardRewriteCopyButton},n.createElement(P.h,{"data-testid":"grammarly-g2-sideline-card-regenerate-btn",variant:"tertiary",accessibilityLabel:"Regenerate",icon:M.a,size:"small",onClick:e.onRegenerate})),n.createElement(L,null)))));var a,s,o};var Q=i(73787),X=i(46323);const Z=({title:e,text:t,onMount:i})=>(h.P.useEffectOnDidMount((()=>i())),n.createElement(S.k,{direction:"column",height:"100%",justify:"center","data-testid":"grammarly-g2-sideline-card-rewrite-success",className:X.sidelineCardRewriteSuccess},n.createElement(S.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-success-main",align:"center",gap:4},n.createElement(x.J,{size:"small",accessibilityLabel:"",icon:Q.j}),n.createElement(S.k,{direction:"column","data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},n.createElement(b.x,{className:X.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),n.createElement(b.x,{as:"p",variant:"text-small",color:"base-subdued"},t))),n.createElement(L,{className:X.sidelineCardRewriteSuccessGrammarlyLogo}))),ee=e=>n.createElement(S.k,{accessibilityLabel:te(e.kind),padding:3,height:"10rem",direction:"column","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"data-testid":"grammarly-g2-sideline-card-rewrite",className:F.sidelineCardRewrite},(()=>{switch(e.kind){case"loading":return n.createElement(T,{onMount:e.onMount});case"ready":return n.createElement(K,{title:e.title,newText:e.newText,diffProps:e.diffProps,sidelineType:e.sidelineType,rewriteType:e.rewriteType,onApply:e.onApply,onCopy:e.onCopy,onMount:e.onMount,onRegenerate:e.onRegenerate,onClickFeedbackButton:e.onClickFeedbackButton});case"success":return n.createElement(Z,{title:e.title,text:e.text,onMount:e.onMount});case"error":return n.createElement(I,{errorDetails:e.errorDetails,onMount:e.onMount});default:(0,g.L0)(e)}})());function te(e){switch(e){case"loading":return"Loading suggested rewrite";case"ready":case"success":return"Suggested rewrite";case"error":return"An error occurred";default:(0,g.L0)(e)}}const ie="⮐",re="←",ne=({customPromptRewriteInfo:e,suggestedCustomPrompts:t,recentCustomPrompts:i,onGoBack:r,onChange:a,onSubmit:s})=>{const[o,l]=n.useState(""),d=n.useCallback((()=>{const e=o.trim();e.length>0&&s(e)}),[o]),c=n.useCallback((e=>{0===o.length&&"Backspace"===e.key&&(e.preventDefault(),e.stopPropagation(),r())}),[o]);return n.createElement(S.k,{className:C.sidelineCardCustomPrompt,direction:"column","data-testid":"grammarly-g2-sideline-card-custom-prompt"},n.createElement(S.k,{className:C.sidelineCardCustomPromptInput,align:"center",gap:{column:3},padding:2},n.createElement(v,{onClick:r,accessibilityLabel:"Go back",text:re,"data-testid":"grammarly-g2-sideline-card-custom-prompt-back-button"}),n.createElement("form",{className:C.sidelineCardCustomPromptInputForm,onSubmit:e=>{e.preventDefault(),d()}},n.createElement("input",{autoFocus:!0,type:"text",className:C.sidelineCardCustomPromptInputField,"aria-label":"Enter your prompt",placeholder:"Enter your prompt",onChange:e=>{l(e.target.value),a(e.target.value.trim())},onKeyDown:c,"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-field"}),n.createElement("input",{type:"submit",style:{display:"none"},"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-form-submit"})),o.trim().length>0&&n.createElement(v,{onClick:()=>d(),text:"Submit",shortcut:ie})),e?n.createElement(ee,{...e}):n.createElement(S.k,{className:C.sidelineCardCustomPromptSuggestedResults,direction:"column",gap:{row:2},padding:2},n.createElement(b.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:C.sidelineCardCustomPromptSuggestedResultsSubtitle},"Tell us how to change this text.",t.length>0?" Try ideas below:":""),t.map((e=>n.createElement(v,{key:e,className:C.sidelineCardCustomPromptSuggestedResultsOption,iconStart:_.p,text:e,accessibilityLabel:`Submit suggested prompt: ${e}`}))),i.length>0&&n.createElement(b.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:C.sidelineCardCustomPromptSuggestedResultsSubtitle},"Recent"),i.map((e=>n.createElement(v,{key:e,className:C.sidelineCardCustomPromptSuggestedResultsOption,iconStart:y.w,text:e,accessibilityLabel:`Submit recent prompt: ${e}`})))))};const ae=({shortenRewriteInfo:e,friendlyRewriteInfo:t,formalRewriteInfo:i,improveTabRef:r,onClickCustomPromptEntryPoint:a})=>n.createElement(m.m.TabList,{accessibilityLabel:"Type of rewrite",bottomBorder:"none"},n.createElement(m.m.Tab,{id:"improve",label:"Improve",ref:r}),n.createElement(m.m.Tab,{id:"rephrase",label:"Rephrase"}),!e&&!t&&!i&&n.createElement(m.m.Tab,{id:"more",label:"More"}),e&&n.createElement(m.m.Tab,{id:"shorten",label:"Shorten"}),t&&n.createElement(m.m.Tab,{id:"friendly",label:"Friendly"}),i&&n.createElement(m.m.Tab,{id:"formal",label:"Formal"}),n.createElement(v,{className:u.sidelineCardCustomPromptEntryPoint,onClick:a,"data-testid":"grammarly-g2-sideline-card-custom-prompt-entry-point",text:"Enter your own...",accessibilityLabel:"Enter your own prompt"})),se=({improveRewriteInfo:e,rephraseRewriteInfo:t,shortenRewriteInfo:i,friendlyRewriteInfo:r,formalRewriteInfo:a})=>n.createElement(n.Fragment,null,n.createElement(m.m.Panel,{id:"improve"},n.createElement(ee,{...e})),n.createElement(m.m.Panel,{id:"rephrase"},n.createElement(ee,{...t})),i&&n.createElement(m.m.Panel,{id:"shorten"},n.createElement(ee,{...i})),r&&n.createElement(m.m.Panel,{id:"friendly"},n.createElement(ee,{...r})),a&&n.createElement(m.m.Panel,{id:"formal"},n.createElement(ee,{...a}))),oe=({tabListPosition:e,sidelineCard:t,improveRewriteInfo:i,rephraseRewriteInfo:r,shortenRewriteInfo:a,friendlyRewriteInfo:s,formalRewriteInfo:o,suggestedCustomPrompts:l,recentCustomPrompts:d,customPromptRewriteInfo:c,feedbackForm:p,onChangeCustomPrompt:f,onSubmitCustomPrompt:w,onChangeSelectedRewriteType:v,onClickMoreTab:S,onShow:b,onClose:_})=>{const[y,C]=n.useState({kind:"improve"}),[k,x]=n.useState({kind:"improve"}),R=n.useRef(null),E=n.useRef(null);n.useEffect((()=>v(k)),[k]),n.useEffect((()=>{b(t),null!==E.current&&_(E.current),E.current=t}),[t.sideline.id]),h.P.useEffectOnWillUnmount((()=>_(t)));const I=n.createElement(ae,{shortenRewriteInfo:a,friendlyRewriteInfo:s,formalRewriteInfo:o,improveTabRef:R,onClickCustomPromptEntryPoint:()=>{C(k),x({kind:"customPrompt",prompt:""})}}),F=n.createElement(se,{improveRewriteInfo:i,rephraseRewriteInfo:r,shortenRewriteInfo:a,friendlyRewriteInfo:s,formalRewriteInfo:o});return n.createElement("div",{className:u.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},p||("customPrompt"===k.kind?n.createElement(ne,{suggestedCustomPrompts:null!=l?l:[],recentCustomPrompts:null!=d?d:[],customPromptRewriteInfo:c,onGoBack:()=>x(y),onChange:f,onSubmit:w}):n.createElement(m.m,{defaultSelectedTab:k.kind,onChange:e=>{var t;"more"===e?(S(),null===(t=R.current)||void 0===t||t.click()):x(function(e){switch(e){case"improve":return{kind:"improve"};case"rephrase":return{kind:"rephrase"};case"shorten":return{kind:"shorten"};case"friendly":return{kind:"friendly"};case"formal":return{kind:"formal"};default:(0,g.L0)(e)}}(e))}},"top"===e?I:F,n.createElement("div",{className:u.sidelineCardHorizontalDivider}),"bottom"===e?I:F)))};var le=i(15868),de=i(43784),ce=i(81682),he=i(72235),ge=i(69910);const me=({referenceElement:e,onMouseEnter:t,onMouseLeave:i,onFocus:r,onClickAway:a,onEscPress:s,children:o})=>{const[l,d]=n.useState(null),c=n.useMemo((()=>({name:"offset",options:{offset:({placement:e})=>["right-end"===e?0:he.B+4,ce.SIDELINE_PARAGRAPH_HIGHLIGHTER_PADDING]}})),[]),h=n.useMemo((()=>({name:"flip",options:{fallbackPlacements:["top-start","right-end"]}})),[]),{styles:g,attributes:m,state:u}=(0,le.D)(e,l,{placement:"bottom-start",modifiers:[c,h]});return n.useEffect((()=>{const e="keydown",t=e=>{"Escape"===e.key&&(e.stopImmediatePropagation(),s(e))};return document.addEventListener(e,t,true),()=>{document.removeEventListener(e,t,true)}}),[s]),n.createElement(de.d,{onClickAway:a},n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-popper",role:"dialog","aria-label":"Suggested rewrite dialog",tabIndex:0,ref:d,style:g.popper,className:ge.sidelineCardPopper,onMouseEnter:t,onMouseLeave:i,onFocus:r,...m.popper},o(null==u?void 0:u.placement)))};var ue=i(32066);const pe=({sidelineCard:e,getSidelineCardState:t,onActivateSidelineCard:i,onDeactivateSidelineCard:h,onChangeSelectedRewriteType:m,onMountRewriteLoading:u,onMountRewriteEmpty:p,onMountRewriteReady:f,onMountRewriteError:w,onApplyRewrite:v,onCopyRewrite:S,onRegenerateRewrite:b,onChangeCustomPrompt:_,onSubmitCustomPrompt:y,onClickMoreTab:C,onClickFeedbackButton:k,onShow:x,onClose:R})=>{const E=(e,t)=>function(e,t,i,n,a,s,o,d,c,h){return"loading"===e.kind||"idle"===e.kind?{kind:"loading",onMount:()=>i(e)}:"ready"===e.kind?e.text===e.rewriteText?{kind:"success",title:"This text is well-written",text:"To see a different version, select a rewrite option.",onMount:()=>n(e)}:{kind:"ready",title:e.title,newText:e.rewriteText,diffProps:(0,r.zG)(e.rewriteDiff,l.UI((t=>({diff:t,displayDeletes:"improve"===e.type.kind})))),sidelineType:t,rewriteType:e.type,onMount:()=>a(e),onApply:()=>o(e),onCopy:()=>d(e),onRegenerate:(0,ue.es)(e.type)?void 0:()=>c(e),onClickFeedbackButton:()=>h(e)}:"error"===e.kind?{kind:"error",errorDetails:e.errorDetails,onMount:()=>s(e)}:void(0,g.L0)(e)}(e,t.sideline.kind,(e=>u(e,t)),(e=>p(e,t)),(e=>f(e,t)),(e=>w(e,t)),(e=>v(e,t)),(e=>S(e,t)),(e=>b(e,t)),(e=>k(e,t)));return n.createElement(d.F.Fragment,null,e.pipe(a.U(l.WG),s.O(null),o.G(),a.U((([e,a])=>{const s=null!=a?a:e,o=s?t(s):null;return n.createElement(c,{show:null!==a,transitionDurationMs:150},s&&o&&n.createElement(me,{referenceElement:s.referenceElement,onMouseEnter:()=>i(s,!1),onMouseLeave:()=>h(s,!1),onFocus:()=>i(s,!0),onClickAway:()=>h(s,!0),onEscPress:()=>h(s,!0)},(e=>n.createElement(d.F.Fragment,null,o.view((t=>n.createElement(oe,{tabListPosition:"top-start"===e?"bottom":"top",sidelineCard:s,improveRewriteInfo:E(t.improveRewriteInfo,s),rephraseRewriteInfo:E(t.rephraseRewriteInfo,s),shortenRewriteInfo:(0,r.zG)(t.shortenRewriteInfo,l.UI((e=>E(e,s))),l.pF(r.r5)),friendlyRewriteInfo:(0,r.zG)(t.friendlyRewriteInfo,l.UI((e=>E(e,s))),l.pF(r.r5)),formalRewriteInfo:(0,r.zG)(t.formalRewriteInfo,l.UI((e=>E(e,s))),l.pF(r.r5)),customPromptRewriteInfo:(0,r.zG)(t.customPromptRewriteInfo,l.UI((e=>E(e,s))),l.pF(r.r5)),feedbackForm:l.WG(t.feedbackForm),onChangeCustomPrompt:e=>_(e,s),onSubmitCustomPrompt:e=>y(e,s),onChangeSelectedRewriteType:e=>m(e,s),onClickMoreTab:()=>C(s),onShow:e=>{x(e)},onClose:e=>{R(e)}})))))))}))))}},81682:(e,t,i)=>{i.r(t),i.d(t,{SIDELINE_PARAGRAPH_HIGHLIGHTER_PADDING:()=>h,SidelineCollection:()=>m});var r=i(90023),n=i(49231),a=i(58303),s=i(99627),o=i(43818),l=i(25770),d=i(72235),c=i(93496);const h=4,g=({sideline:e,isEmphasized:t,isActive:i,viewportRect:r,onPin:a,onActivate:o,onDeactivate:l,onMount:g,onShow:m,onHide:u,onRefChange:p})=>n.createElement(n.Fragment,null,n.createElement("span",{"data-testid":`grammarly-g2-sideline-paragraph-highlighter-${e.id}`,...(0,s.Sh)(c.sidelineParagraphHighlighter,i?c.sidelineParagraphHighlighterActive:void 0),style:{top:r.top-h,left:r.left-d.B/2-h,width:r.width+d.B/2+2*h,height:r.height+2*h}}),n.createElement("span",{"data-testid":`grammarly-g2-sideline-positioner-${e.id}`,className:c.sidelinePositioner,style:{top:r.top,left:r.left-d.B/2}},n.createElement(d.I,{emphasized:i||t,heightInPixels:r.height,sidelineType:e.kind,sidelineId:e.id,isLoading:!1,onClick:()=>a(e),onFocus:()=>a(e),onMouseOver:()=>o(e),onMouseOut:()=>l(e),onMount:()=>g(e),onShow:()=>m(e),onHide:()=>u(e),ref:t=>{t&&p(e,t)}}))),m=({paragraphSidelines:e,pinnedSideline:t,activeSideline:i,emphasizedSideline:s,selectionSideline:d,shouldHideSidelines:c,onPinSideline:h,onActivateSideline:m,onDeactivateSideline:u,onMountSideline:p,onShowSideline:f,onHideSideline:w,onSidelineRefChange:v})=>{const S={onPin:h,onActivate:m,onDeactivate:u,onMount:p,onShow:f,onHide:w,onRefChange:v};return n.createElement(o.F.Fragment,null,l.h.combine(e,t,i,s,d,c,((e,t,i,s,o,l)=>!l&&(0,r.zG)(t,a.UI((e=>n.createElement(g,{sideline:e,isEmphasized:!0,isActive:!0,viewportRect:e.highlightViewportRect,...S}))),a.wp((()=>(0,r.zG)(o,a.UI((e=>n.createElement(g,{sideline:e,isEmphasized:!0,isActive:(0,r.zG)(i,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),viewportRect:e.highlightViewportRect,...S})))))),a.fS((()=>n.createElement(n.Fragment,null,e.map((e=>n.createElement(n.Fragment,{key:e.id},n.createElement(g,{sideline:e,isEmphasized:(0,r.zG)(s,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),isActive:(0,r.zG)(i,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),viewportRect:e.highlightViewportRect,...S})))))))))))}},46393:(e,t,i)=>{i.d(t,{F:()=>r});var r,n=i(60213),a=i(12518),s=i(53186),o=i(3190),l=i(90023),d=i(42530);!function(e){let t;e.getDiff=(e,t)=>(0,l.zG)(a.tryCatch((()=>{const i=new n.diff_match_patch,r=i.diff_main(e,t);return i.diff_cleanupSemantic(r),r}),a.toError),a.chain((0,l.ls)(s.nI,a.fromOption((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(t=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:i,onRetain:r}){return n=>{const a=(0,o.li)(n);switch(a){case t.INSERT:return e((0,o.Yg)(n));case t.DELETE:return i((0,o.Yg)(n));case t.RETAIN:return r((0,o.Yg)(n));default:(0,d.vE)(a)}}}}(r||(r={}))},18597:(e,t,i)=>{if(i.d(t,{PF:()=>m,TY:()=>d,_V:()=>g,eg:()=>h,f:()=>u,yG:()=>l,yj:()=>c}),3075==i.j)var r=i(65647);if(3075==i.j)var n=i(60165);if(3075==i.j)var a=i(63843);if(3075==i.j)var s=i(19775);if(3075==i.j)var o=i(81772);var l,d,c;function h(e){return(0,o.uz)(e)?l.view:(0,o.lW)(e)?l.history:(0,o.e$)(e)?l.noEditAccess:l.edit}function g(e){return s.S.hz4.pipe((0,r.U)((()=>h(e))),(0,n.x)(((e,t)=>e===t)))}function m(e,t){return e?d.ownDoc:t?d.noEditAccessDoc:d.sharedDoc}function u(e,t,i,r){if(e!==l.edit)return c.read;switch(t){case d.ownDoc:return c.write;case d.noEditAccessDoc:return c.read;case d.sharedDoc:return function(e,t,i){const r=!t&&!i;if(e!==l.edit||r)return c.read;return c.write}(e,i,r);default:return(0,a.L0)(t)}}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(l||(l={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(d||(d={})),function(e){e.read="read",e.write="write"}(c||(c={}))},81772:(e,t,i)=>{if(i.d(t,{LJ:()=>v,Nd:()=>o,Ov:()=>w,TW:()=>y,Ur:()=>l,Xs:()=>C,e$:()=>b,eg:()=>_,fN:()=>m,iy:()=>h,k6:()=>p,kh:()=>g,lW:()=>S,lz:()=>u,qg:()=>s,uj:()=>a,uz:()=>f,vc:()=>c}),3075==i.j)var r=i(44025);var n=i(55362);function a(e){const t=(0,r.Cq)(e.querySelector(n.XG),"text buffer iframe");return(0,r.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function s(e){const t=o(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function o(e){return e.querySelector(n.Wp)}function l(e,t,i){return t?function(e,t){if(t&&d(t))return t;const i=e.querySelectorAll(n.Qy);for(const e of i)if(d(e))return e;return null}(e,i):e.querySelector(n.Qy)}const d=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function c(e){return e.querySelector(n.yw)}function h(e){return e.querySelector(n.gv)}function g(e){return e.querySelectorAll(n.gH)}function m(e){return e.querySelector(n.gH)}function u(e){return Boolean(e.querySelector(n.gH))}function p(e){let t=e.querySelector(n.os);return t||(t=document.querySelector(n.gH)),t?t.getBoundingClientRect():null}const f=e=>!!e.querySelector(n.Lq);function w(e){return e.querySelector(n.$x)}function v(e){return null==e?void 0:e.querySelector(n.y1)}function S(e){const t=e.querySelector(n.f);return!!t&&t.offsetHeight>0}function b(e){return!!e.querySelector(`${n.jW}, ${n.F8}`)}function _(){const e=document.querySelector(n.d0),t=(null==e?void 0:e.classList.contains(n.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(n._m))?"suggesting":void 0;return t||i||"other"}function y(e){return e.querySelector(n.QR)}function C(e){return e.querySelector(n.ij)}},55362:(e,t,i)=>{i.d(t,{$x:()=>s,F8:()=>u,Go:()=>n,Kt:()=>_,Lq:()=>d,QR:()=>E,Qy:()=>w,Vk:()=>y,Wp:()=>r,XG:()=>a,_m:()=>g,d0:()=>c,f:()=>l,gH:()=>f,gL:()=>C,gv:()=>p,ij:()=>R,j5:()=>b,jW:()=>m,lO:()=>x,os:()=>S,rx:()=>k,uj:()=>h,y1:()=>o,yw:()=>v});const r=".kix-appview-editor",n=".docos-input",a=".docs-texteventtarget-iframe",s=".kix-cursor",o=".kix-cursor-caret",l="#docs-revisions-sidebar",d='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',c="#docs-toolbar-mode-switcher",h="edit-mode",g="suggest-mode",m="#titlebar-mode-indicator-container .titlebar-request-access-button",u="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",p=".kix-canvas-tile-content",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",w=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",v=".kix-page-paginated",S=".kix-page-paginated.canvas-first-page",b=".docs-horizontal-ruler",_=".docs-vertical-ruler",y="#fontSizeSelect input",C=".docs-ruler-background",k=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",R=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'},41860:(e,t,i)=>{i.d(t,{$O:()=>r,Mx:()=>n,RO:()=>a,vW:()=>s});const r=String.fromCharCode(16),n=String.fromCharCode(17),a=String.fromCharCode(18),s=String.fromCharCode(28)},5233:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(82823),n=i(25770),a=i(16925),s=i(4582);class o{constructor(e){this._textObserver=e,this._mapChangedAtom=n.h.create([0,[]]),this._sub=new r.w,this.highlightsFilterFactory=()=>n.h.combine((0,a.u)(),this._mapChangedAtom,((e,t)=>{const i=this._textObserver.getCurrentTextMap();return{filter:t=>e.filter(t)&&(null!==i.getFragmentAtOffset(t.start)||null!==i.getFragmentAtOffset(t.end)||null!==i.getFragmentAtOffset(t.end-1)),type:s.qH.ChangeType.preserve}})),this._sub.add(this._textObserver.textMapChanged.subscribe((e=>{this._mapChangedAtom.modify((([t,i])=>[t+1,e]))})))}dispose(){this._sub.unsubscribe()}}},35146:(e,t,i)=>{function r(e){return e}function n(e){return e}i.d(t,{Gk:()=>n,Ly:()=>r,Xo:()=>a,bn:()=>g,pl:()=>l});class a{constructor(e){const t=function(e){const{fullText:t,nonTextEntities:i,textSelectionRanges:r,deleteSuggestionRanges:n}=e,a=new Set;let l=t;for(const e of i.inline_image.startsAt)l=l.slice(0,e)+o+l.slice(e+1);for(const e of i.horizontal_rule.startsAt)a.add(e),l=l.slice(0,e)+" "+l.slice(e+1);""===t[0]&&a.add(0);t.replace(s,((e,t)=>(a.add(t),"")));for(const e of function*(e){const t=String.fromCodePoint(60419),i=String.fromCodePoint(60418);for(const r of h(e,t,i))yield r}(t))a.add(e);for(const e of function*(e){for(const t of h(e,d,c))e[t]!==d&&(yield t)}(t))a.add(e);const g=null==r?void 0:r.map((e=>({start:e.start,end:e.end+1})));if(n)for(const{start:e,end:t}of n)for(let i=e;i<t;i++)a.add(i);const m=l.indexOf("",1),u=m>0?l.slice(0,m):l,p=u.length-1;"\n"===u[p]&&a.add(p);return{checkableText:u.split("").filter(((e,t)=>!a.has(t))).join(""),cleanedFullText:l,removedIndices:a,cleanedTextSelectionRanges:g}}(e);this._text=t.checkableText,this._fullText=e.fullText,this._linkInfoList=e.linkInfoList,this._cleanedFullText=t.cleanedFullText,this._ignoredIndices=t.removedIndices,this._textSelectionRanges=t.cleanedTextSelectionRanges}get checkableText(){return this._text}get fullText(){return this._fullText}get cleanedFullText(){return this._cleanedFullText}get linkInfoList(){return this._linkInfoList}get textSelectionRanges(){return this._textSelectionRanges}indexIsIgnored(e){return!!this._ignoredIndices.has(e)}getFullTextIndex(e){let t=-1,i=-1;for(;i<e;)t++,this._ignoredIndices.has(t)||i++;return t}getCheckableTextIndex(e){let t=0,i=0;for(;t<e;)this._ignoredIndices.has(t)||i++,t++;return i}}const s=new RegExp(`${String.fromCodePoint(61439)}|${String.fromCodePoint(61438)}`,"g"),o=String.fromCharCode(160),l=26,d=String.fromCodePoint(l),c=String.fromCodePoint(30);function*h(e,t,i){let r=0;for(;;){const n=e.indexOf(t,r);if(n<r)return;const a=e.indexOf(i,n);for(let e=n;e<=a;e++)yield e;r=a+1}}function g(e){return!!(null==e?void 0:e.includes(d))&&!(null==e?void 0:e.includes(`${d}${c}`))}},29066:(e,t,i)=>{i.d(t,{U3:()=>r,dk:()=>a,x:()=>n});const r=["rgba(17,85,204,1)","#1155cc"],n=1,a=-1},44643:(e,t,i)=>{i.d(t,{M:()=>r});class r{constructor(e,t){this._page=e,this._parsedFragment=t,this.startOffset=t.textRange.start,this.endOffset=t.textRange.end}getPage(){return this._page}}},91450:(e,t,i)=>{i.d(t,{I:()=>s});var r=i(29066),n=i(3526),a=i(44643);class s extends a.M{constructor(e,t,i){super(e,t),this._page=e,this._renderGeometry=i}getFragmentInnerRect(e,t){return this._renderGeometry.getTextFragmentDimensions(this._parsedFragment.fragment,e,t)}getLeftBorder(){return this.getFragmentInnerRect(0,0)}getRightBorder(){return this.getFragmentInnerRect(this.endOffset-this.startOffset,this.endOffset-this.startOffset)}getStyle(){const{style:e="none",color:t="none",underlineColor:i="none",strikeThroughColor:a="none",text:s}=this._parsedFragment.fragment;return{style:e,isLink:r.U3.includes(t)&&r.U3.includes(i),canBeFootnote:(0,n.cX)(s),color:t,underlineColor:i,strikeThroughColor:a}}getParsedFragment(){return this._parsedFragment}}},3526:(e,t,i)=>{i.d(t,{cX:()=>f,ds:()=>l,kn:()=>d,lO:()=>u,nn:()=>p,qH:()=>o,tZ:()=>w});var r=i(73674);const n=/[ \n\r\t\v]/,a=/[^\S\f\n]/,s=[..." \r\t\v\f"];function o(e){return 1===e.length&&n.test(e)}function l(e){return 1===e.length&&a.test(e)}function d(e){return s.includes(e)}const c=/^(\d{1,4}\.)*\d{1,4}$/,h=/^([a-zA-Z])\1{0,3}$/,g=/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,m=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/;function u(e){if(0===e.length)return!1;if(1===e.length)return!0;let t;if(e.startsWith("(")&&e.endsWith(")"))t=e.substring(1,e.length-1);else{if(!e.endsWith(".")&&!e.endsWith(")"))return!1;t=e.substring(0,e.length-1)}return t.endsWith(".")&&(t=t.substring(0,t.length-1)),c.test(t)||h.test(t)||g.test(t)||m.test(t)}function p(e){return r.v1.test(e)}function f(e){return r.ZS.test(e)}function w(e){return r.Dn.includes(e)}},73674:(e,t,i)=>{if(i.d(t,{Dn:()=>s,Ox:()=>c,ZS:()=>d,o2:()=>a,q4:()=>h,ui:()=>o,v1:()=>l}),3075==i.j)var r=i(41860);var n=i(35146);const a=String.fromCodePoint(59657),s=[59653,59654,59657,60417,60416,59656,n.pl].map((e=>String.fromCodePoint(e))).join(""),o=String.fromCodePoint(59649),l=/^\d+$/,d=/^\d+$/;function c(e){return e.toUpperCase()===e&&e.toLowerCase()!==e}function h(e){return e.includes(r.$O)}},74927:(e,t,i)=>{i.d(t,{J:()=>c});var r=i(90023),n=i(49231),a=i(82089),s=i(63469),o=i(78488),l=i(99627),d=i(61301);const c=({onChange:e,labelId:t,className:i,checkboxClassName:c,labelClassName:h,checked:g,children:m,disabled:u,useDS:p,dataGrammarlyPart:f="ui-kit-checkbox",tabIndex:w=0,onMount:v=r.Q1})=>{const[S,b]=n.useState(null!=g&&g);n.useEffect((()=>{b(Boolean(g))}),[g]);const _=t=>{t.preventDefault(),t.stopPropagation(),b(!S),null==e||e(!S)},{ref:y,onMount:C}=a.P.useElWatcher();return n.useEffect((()=>{const e=y.pipe(s.oA,o.b(v)).subscribe();return()=>e.unsubscribe()}),[]),n.createElement("div",{"data-grammarly-part":f,...(0,l.Sh)(d.checkboxContainer,i)},n.createElement("div",{...(0,l.Sh)(d.checkbox,c,S?d.checkboxChecked:null,p?d.checkboxDS:null),role:"checkbox","aria-checked":S,tabIndex:w,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&_(e)},onClick:u?r.Q1:_,ref:C},S?n.createElement("div",{className:d.checkboxCheckmark}):null),n.createElement("label",{id:t,onClick:_,className:h},m))}},26664:(e,t,i)=>{i.d(t,{z:()=>g});var r=i(49231),n=i(64151);const a=({children:e,style:t,dataGrammarlyPart:i="ui-kit-iframe",...a})=>{const[s,o]=r.useState(null),l=r.useCallback((e=>{var t,i;let r=null;"contentDocument"in e.target&&(r=null!==(i=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==i?i:null),o(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...a,style:{border:"none",...t},onLoad:l,srcDoc:"<html><body></body></html>","data-grammarly-part":i},s&&(0,n.createPortal)(e,s))};var s=i(36425),o=i(23940),l=i.n(o),d=i(50293),c=i(90522);const h=({placeholder:e,ariaLabel:t,onChange:i})=>{const[n,a]=r.useState("");return r.useEffect((()=>{i(n)}),[n]),r.createElement(r.Fragment,null,r.createElement(s.b,null,l().__css),r.createElement("div",{role:"textbox",className:l().textBox,contentEditable:!0,onInput:e=>{a(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},g=({placeholder:e,onChange:t,ariaLabel:i,iframeTitle:n,className:s})=>(0,d.E)().experimentClient.isGateEnabled(c.K.CentralizeStopEventPropagation)?r.createElement("div",{className:s,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(h,{onChange:t,ariaLabel:i,placeholder:e})):r.createElement(a,{dataGrammarlyPart:"ui-kit-textbox",className:s,style:{width:"100%",height:"100%"},title:n},r.createElement(h,{onChange:t,ariaLabel:i,placeholder:e}))},44860:(e,t,i)=>{i.d(t,{q:()=>I});var r=i(49231),n=i(90522),a=i(99627),s=i(40359),o=i(17517);const l=({fixSubmitButtonOverflowBottomPadding:e,className:t,...i})=>r.createElement(r.Fragment,null,r.createElement(s.z,{...i,className:null!=t?t:o.feedbackFormSubmitButton},i.children),r.createElement(d,{isEnabled:e})),d=e=>e.isEnabled?r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null,c=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,a.Sh)(o.feedbackFormContainer,o.feedbackFormContainerAlignCenter)},r.createElement("div",{className:o.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:o.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:o.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:o.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(l,{type:"button",kind:"success",onClick:e.onClose},"Done"));var h=i(26664),g=i(42530),m=i(48448);const u=({options:e,onChange:t=(()=>null),ariaLabel:i,className:n})=>{const s=[],[o,l]=r.useState(null);r.useEffect((()=>{var i;null!==o&&(null===(i=s[o])||void 0===i||i.focus()),t(null!==o?e[o].value:null)}),[o]);const d=null!==o?e[o]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:n},r.createElement("div",{className:m.radioGroup,role:"radiogroup","aria-label":i,onKeyDown:t=>{if(" "!==t.key||d){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();l(((o||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const i=(o||0)-1;l(i<0?e.length-1:i)}}else t.preventDefault(),t.stopPropagation(),l(0)}},e.map(((e,t)=>{const i=(null==d?void 0:d.value)===e.value,n=0===t;return r.createElement("div",{key:e.value,...(0,a.Sh)(m.radioGroupOption,i?m.radioGroupOptionSelected:null),role:"radio",tabIndex:i||n&&!d?0:-1,"aria-checked":i,onClick:e=>{e.preventDefault(),e.stopPropagation(),l(t)},ref:e=>s.push(e)},e.render())}))))};var p;!function(e){e.bad="bad",e.ok="ok",e.good="good"}(p||(p={}));var f=i(75084);const w=e=>{const t=[p.bad,p.ok,p.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(u,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:f.feedbackFormOption},r.createElement("div",{...(0,a.Sh)(f.feedbackFormOptionIcon,v(e))}),r.createElement("div",null,function(e){switch(e){case p.bad:return"I dislike it";case p.ok:return"It’s OK";case p.good:return"I like it";default:(0,g.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,a.Sh)(o.feedbackFormScore,e.compactDisplay&&o.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:o.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function v(e){switch(e){case p.bad:return f.feedbackFormOptionIconDisheartening;case p.ok:return f.feedbackFormOptionIconNeutral;case p.good:return f.feedbackFormOptionIconSmiling;default:(0,g.vE)(e)}}var S=i(16502);const b=e=>e.isEnabled?r.createElement(S.T,{type:"mini",size:26,className:o.feedbackFormLogoLine}):null,_=e=>{var t;if(!e.isEnabled)return null;const i=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,a.Sh)(o.feedbackFormTitle,e.isCompact&&o.compact)},i)};var y=i(74927);const C=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:o.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(y.J,{labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:o.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null,k=e=>{var t,i,n;const[s,d]=r.useState(null),[c,g]=r.useState(""),[m,u]=r.useState(!1);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,a.Sh)(o.feedbackFormContainer,"center"===e.align&&o.feedbackFormContainerAlignCenter)},r.createElement("div",{className:o.feedbackFormFields},r.createElement(b,{isEnabled:!e.hideLogo}),r.createElement(_,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(t=e.compactDisplay)&&void 0!==t&&t}),r.createElement(w,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:d}),r.createElement(h.z,{onChange:g,placeholder:null!==(i=e.placeholderText)&&void 0!==i?i:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,a.Sh)(o.feedbackFormTextBox,e.compactDisplay&&o.compact)}),r.createElement(C,{domain:e.domain,withHelpText:!e.hideDomainHelpText,onChange:u})),r.createElement(l,{type:"submit",kind:null!==(n=e.submitButtonKind)&&void 0!==n?n:"success",disabled:e.withScore?!s:!c,fixSubmitButtonOverflowBottomPadding:e.fixSubmitButtonOverflowBottomPadding,onClick:t=>{t.preventDefault();const i=m?e.domain:void 0;e.withScore&&s?e.onSubmit({score:s,text:c,domain:i}):!e.withScore&&c&&e.onSubmit({text:c,domain:i})}},"Submit"))};var x=i(95320);const R=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:i=!1,showPostSubmitScreen:n=!0,...a})=>{const[s,o]=r.useState(!1),l=s&&n;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},l?r.createElement(c,{fixSubmitButtonOverflowBottomPadding:i,onClose:a.onClose}):r.createElement(k,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:i,onSubmit:e=>{a.withScore?((0,x.n8)(e),a.onSubmit(e)):((0,x.TY)(e),a.onSubmit(e)),o(!0)}}))},E=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:i=!1,...n})=>{var l;const d=[p.bad,p.ok,p.good],[c,g]=r.useState(null),[m,w]=r.useState(""),[v,S]=r.useState(!1),[_,C]=r.useState(!1);let k;return k=_&&!1!==n.showPostSubmitScreen?r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,a.Sh)(o.feedbackFormContainer,o.feedbackFormContainerAlignCenter)},r.createElement("div",{className:o.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:o.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:o.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:o.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(s.z,{className:o.feedbackFormSubmitButton,kind:"success",type:"submit",onClick:n.onClose},"Done"),i?r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null):r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,a.Sh)(o.feedbackFormContainer,"center"===t?o.feedbackFormContainerAlignCenter:null)},r.createElement("div",{className:o.feedbackFormFields},r.createElement(b,{isEnabled:!e}),n.hideTitle?null:r.createElement("div",{...(0,a.Sh)(o.feedbackFormTitle,n.compactDisplay?o.compact:null)},n.title||r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?")),n.withScore?r.createElement(r.Fragment,null,r.createElement(u,{ariaLabel:"Feedback Score",options:d.map((e=>({value:e,render(){let t,i;return e===p.bad?(t=f.feedbackFormOptionIconDisheartening,i="I dislike it"):e===p.ok?(t=f.feedbackFormOptionIconNeutral,i="It’s OK"):(t=t=f.feedbackFormOptionIconSmiling,i="I like it"),r.createElement("div",{className:f.feedbackFormOption},r.createElement("div",{...(0,a.Sh)(f.feedbackFormOptionIcon,t)}),r.createElement("div",null,i))}}))),onChange:g,...(0,a.Sh)(o.feedbackFormScore,n.compactDisplay?o.compact:null)}),n.hideTextBoxTitle?null:r.createElement("div",{className:o.feedbackFormTextBoxTitle},"Anything we can improve?")):null,r.createElement(h.z,{onChange:w,placeholder:n.placeholderText||"Your thoughts here",ariaLabel:"Feedback Text",...(0,a.Sh)(o.feedbackFormTextBox,n.compactDisplay?o.compact:null)}),n.domain?r.createElement(r.Fragment,null,n.hideDomainHelpText?null:r.createElement("div",{className:o.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(y.J,{labelId:"feedback-form-share-domain-checkbox",onChange:S,className:o.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,n.domain)," with my feedback")):null),r.createElement(s.z,{className:o.feedbackFormSubmitButton,kind:null!==(l=n.submitButtonKind)&&void 0!==l?l:"success",type:"submit",disabled:n.withScore?!c:!m,onClick:()=>{var e,t;n.withScore&&c?(null===(e=n.onSubmit)||void 0===e||e.call(n,{score:c,text:m,domain:v?n.domain:void 0}),C(!0)):!n.withScore&&m&&(null===(t=n.onSubmit)||void 0===t||t.call(n,{text:m,domain:v?n.domain:void 0}),C(!0))}},"Submit"),i?r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null),r.createElement("div",{style:n.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback"},k)},I=({experimentClient:e,...t})=>e.isGateEnabled(n.K.ExtensionA11yKeyboardNavigation)?r.createElement(R,{...t}):r.createElement(E,{...t})},95320:(e,t,i)=>{function r(e){return"score"in e}function n(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}i.d(t,{TY:()=>a,dK:()=>r,n8:()=>n})},27943:(e,t,i)=>{i.d(t,{Sz:()=>a,vQ:()=>n});var r=i(12518);async function n(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function a(e,t=self){return n(e,t).then((()=>r.right(void 0))).catch((e=>r.left(e instanceof Error?e:new Error(String(e)))))}},57536:(e,t,i)=>{function r(e,t=0){return(t<<5)-t+(0|e)|0}function n(e,t=0){let i=t;for(const t of e)i=r(t.charCodeAt(0),i);return i}i.d(t,{Wu:()=>n,k3:()=>r})},43527:(e,t,i)=>{var r=i(59976),n=i(97251)(r);n.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),n.locals={textBox:"_z3YOv-textBox"},e.exports=n},8780:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineWithSelectionSignal:"ikZS7",sidelineWithSignalBar:"gtUhG",sidelineSignalBar:"Pdlcn",sidelineSignalBarLoading:"ZhtAx",pulse:"PEPt4",sidelineSignalBarAttention:"xQocX",sidelineSignalBarEmphasized:"_mi1U",sidelineSignalBarHidden:"BNKg6",sidelineArrow:"Ihuz1",sidelineArrowVisible:"gtlTF",sidelineArrowBottom:"PPzfY"}},6584:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB",sidelineCardCustomPromptEntryPoint:"USGAc"}},10555:e=>{e.exports={sidelineCardButton:"qFbmx"}},92935:e=>{e.exports={sidelineCardCustomPrompt:"LfX1e",sidelineCardCustomPromptInput:"RoTP_",sidelineCardCustomPromptInputForm:"B0peX",sidelineCardCustomPromptInputField:"SLnHC",sidelineCardCustomPromptSuggestedResults:"o_ldN",sidelineCardCustomPromptSuggestedResultsSubtitle:"eezEJ",sidelineCardCustomPromptSuggestedResultsOption:"FmvTD"}},10695:e=>{e.exports={sidelineCardGrammarlyLogo:"e99eq"}},69910:e=>{e.exports={sidelineCardPopper:"m2vlI"}},56732:e=>{e.exports={sidelineCardRewrite:"SbBwe"}},43831:e=>{e.exports={sidelineCardRewriteCopyButton:"_kIwY","5rem":"TE61X",sidelineCardRewriteCopyButtonCopyConfirmation:"eH5TV"}},69587:e=>{e.exports={sidelineCardRewriteReadySignalBar:"zv_Ws",sidelineCardRewriteReadySignalBarAttention:"oimfv",sidelineCardRewriteReadySignalBarDefault:"GGpaV",sidelineCardRewriteReadyContentScrollable:"Cq6T4",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleAttention:"ncGgB",sidelineCardRewriteReadyContentTitleDefault:"FKJEV",sidelineCardRewriteRegenerateButton:"As2d2","5rem":"DP1UN"}},46323:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessGrammarlyLogo:"PWfBY"}},93496:e=>{e.exports={sidelineParagraphHighlighter:"ch8Da",sidelineParagraphHighlighterActive:"x3IoY",sidelinePositioner:"lx6ct"}},61301:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},48448:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},17517:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormSubmitButton:"tYYGU",feedbackFormSubmitButtonFixOverflowBottomPadding:"Opd8X",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"QKLT7",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},75084:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);